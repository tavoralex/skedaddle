{"version":3,"sources":["../node_modules/peerjs/dist sync","components/types.ts","utils/colorConversions.ts","components/common/Button.tsx","components/practice/PracticeOver.tsx","components/practice/HudPractice.tsx","components/duel/DuelOver.tsx","components/duel/HudDuel.tsx","components/intro/IntroScreen.tsx","components/info/About.tsx","utils/uuid.ts","components/lobby/getLobbyState.ts","components/lobby/peerLogic.ts","components/lobby/Lobby.tsx","components/duel/copyToClipboard.js","components/lobby/ActionButton.tsx","components/Hud.tsx","components/duel/TimeCountdown.tsx","utils/loop/animationLoop.ts","utils/loop/deltaLoop.ts","utils/loop/timeVariableLoop.ts","pixi/boids/makeBoidsViews.ts","game/collectorTouchedTween.js","pixi/addDisplayDragListener.ts","game/addDropFunctionality.ts","pixi/addDisplayClickListener.ts","scentmap/scent/makeScentDropper.ts","game/init/makeScentDroppers.tsx","utils/geom.ts","boids/makeBoid.ts","boids/behavior/separation.ts","boids/behavior/cohesion.ts","boids/steering/seek.ts","boids/steering/applyForce.ts","boids/GridBoids.ts","boids/makeBoids.ts","boids/getSteering.ts","game/init/boidTemplate.tsx","game/init/makeBoids.tsx","pixi/hexgrid/makeHexesGrid.ts","game/init/makeAvoidScent.tsx","scentmap/scent/makeScent.tsx","scentmap/scent/makeUpdateScent.ts","pixi/scent/makeUpdateHexColorsByScent.tsx","scentmap/hexgrid/hexagons.ts","scentmap/hexgrid/Grid.ts","pixi/hexgrid/makeGridCamera.ts","pixi/makeCamera.ts","utils/simplexNoise.ts","pixi/hexgrid/repaintWithNoise.ts","pixi/makeDisplay.ts","pixi/hexgrid/addPrettyHexesClick.ts","pixi/makePixiApp.ts","pixi/hexgrid/makeHexTexture.ts","pixi/walls/makeWallsView.ts","game/init/makeMap.tsx","scentmap/walls/makeWalls.tsx","game/makeFillbars.ts","game/init/initialize.tsx","game/makeCollectors.ts","App.tsx","index.js"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","GAME_STATE","letters","rgbArrayToHex","arr","length","r","g","b","toHex","x","hex","Math","round","toString","parseInt","concat","hexToRgb","result","exec","hue2rgb","p","q","t","hslToRgb","h","s","l","hexValueToString","value","hueString","Button","styleDefault","Object","objectSpread","width","height","backgroundColor","colors","default","display","transition","style","_useState","useState","_useState2","slicedToArray","isDown","setisDown","_useState3","_useState4","isHover","setIsHover","_useState5","_useState6","setStyle","colorDown","down","colorHover","hover","useEffect","disabled","color","pointerEvents","react_default","a","createElement","onMouseEnter","onMouseLeave","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","onClick","gridRow","gridColumn","alignSelf","justifySelf","fontWeight","fontSize","padding","userSelect","textStyle","title","children","PracticeOver","data","window","innerHeight","innerWidth","gridTemplateRows","gridTemplateColumns","Button_Button","actions","startGame","gameState","intro","fontStyle","textShadow","position","HudPractice","score","top","topValue","settopValue","autorun","fillbars","max","topFillbarValue","settopFillbarValue","isGameOver","setisGameOver","v","maxWidth","topColor","PracticeOver_PracticeOver","left","console","log","margin","bottom","DuelOver","reset","lobby","HudDuel","bottomValue","setBottomValue","bottomFillbarValue","setBottomFillbarValue","_useState7","_useState8","_useState9","_useState10","getStringVal","bottomColor","DuelOver_DuelOver","right","IntroScreen","isVisible","setisVisible","practice","about","About","textAlign","whiteSpace","paddingLeft","paddingRight","uuid","random","replace","getLobbyState","lobbyState","observable","peer","status","ownId","ownPeerData","isReady","nodesTouched","otherPeerData","connectTo","state","onData","onConnection","Peer","_ref","asyncToGenerator","regenerator_default","mark","_callee","wrap","_context","prev","next","abrupt","Promise","reject","conn","connect","on","send","bind","stop","_x","apply","this","arguments","peerLogic","d","action","boids","placeSelf","paddingBottom","rowStyle","undefined","Lobby","friendKey","setfriendKey","setStatus","paddingTop","str","el","document","setAttribute","body","appendChild","selected","getSelection","rangeCount","getRangeAt","select","execCommand","removeChild","removeAllRanges","addRange","copyToClipboard","type","onChange","target","duel","reply","assign","marginTop","Boolean","_reply","sent","isOP","_onClick","_callee2","_context2","ActionButton","Hud","hud","setgameState","HudPractice_HudPractice","HudDuel_HudDuel","IntroScreen_IntroScreen","About_About","Lobby_Lobby","TimeCountdown","isTimed","setisTimed","tLeft","ceil","maxDuration","duration","secondsLeft","setsecondsLeft","endGame","touchAction","animationLoop","callback","requestAnimationFrame","cancelAnimationFrame","current","Date","now","timeVariableLoop","time","nc","delta","deltaLoop","speed","makeBoidsViews","tex","quantity","maxBoids","view","ParticleContainer","uvs","tint","rotation","vertices","sprites","Array","from","sprite","Sprite","addChild","i","floor","randomColor","collectorTouchedTween","_ref$duration","Tween","scale","set","alpha","to","start","easing","Quadratic","Out","isDragging","addDropFunctionality","grid","onDrag","onTap","onStart","onEnd","hs","gridLayout","hexSize","camera","getHexIdByPixel","world","y","addDisplayClickListener","onMove","getNodeByPixel","point","global","node","toWorld","isNaN","addEventListener","addDisplayDragListener","makeScentDropper","scent","index","seconds","elapsed","scentGrid","makeScentDroppers","map","droppers","updates","isDropping","lastDelta","dropOwn","push","bars","ls","fill","update","filter","dropFromPeer","nodes","forEach","clamp","limit","magnitude","n","normalize","multiplyScalar","distanceSq","dx","dy","sqrt","m","scalar","divideByScalar","addVector","subtractVector","makeBoid","template","velocity","drag","thrust","radius","separation","boid","neighbors","steer","numNeighbors","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","neighbor","diff","err","return","cohesion","seek","applyForce","vector","force","GridBoids","boidTemplate","walls","scentToAvoid","classCallCheck","boidViews","occupiableNodes","numNodes","initialize","createClass","key","numBoids","boidViewsObj","hexTexture","gridArr","Set","parent","updateBoids","updateViews","nodeId","getPosAtNode","splice","indexOf","pop","_this","hue","_this2","oNodes","delete","neighborNodes","obstacles","ns","highestScent","avoidGoal","avoidVal","olfaction","avoidGoals","forces","steering","getSteering","weights","avoidObstacles","avoidScent","applySteering","add","motion","seekScent","alignment","populateBoids","addBoidAtNode","makeBoids","makeHexesGrid","PIXI","makeAvoidScent","spread","evaporation","minValue","permeability","makeScent","updateScent","w","targets","scentVal","validTargets","distribute","min","dSlice","updateScentView","gridSprites","average","makeUpdateHexColorsByScent","Point","Hex","n8s","roundHex","direction","directions","k","diagonals","abs","subtract","len","qi","ri","si","qDiff","rDiff","sDiff","N","distance","aNudge","bNudge","results","step","lerp","get","OffsetCoord","col","row","offset","EVEN","ODD","DoubledCoord","Orientation","f0","f1","f2","f3","b0","b1","b2","b3","startAngle","Layout","orientation","size","origin","M","pt","corner","angle","PI","cos","sin","corners","center","hexToPixel","hexCornerOffset","pointy","flat","makeNeighbors2","hh","Grid","edges","gridHash","_layout","_hexes","minCol","maxCol","minRow","maxRow","rdoubledToCube","hexagons","columns","rows","hIds","reduce","acc","cur","entry","neighbors2","String","findIndex","polygonCorners","pixelToHex","makeGridCamera","pixi","lastNode","cam","worldWidth","worldHeight","viewport","Viewport","screenWidth","screenHeight","stage","makeCamera","underflow","clampZoom","minWidth","minHeight","Grad","z","grad3","perm","gradP","G3","simplex3","xin","yin","zin","i1","j1","k1","i2","j2","k2","j","x0","y0","z0","x1","y1","z1","x2","y2","z2","x3","y3","z3","gi0","gi1","gi2","gi3","t0","t1","t2","t3","dot3","noise","BgType","defaultSpeed","addPrettyHexesClick","hexes","processNodesForDistance","dist","rgb","hsl","rgbToHsl","distances","maxDist","hex2","toConsumableArray","hexPoint","getHexPosAtPixel","processNode","getDistances","makeDisplay","gameCanvas","bgType","none","transparent","makePixiApp","app","graphics","lineStyle","beginFill","pixiCorners","getHexShape","c","poly","drawPolygon","endFill","renderer","generateTexture","NEAREST","makeHexTexture","bgSprites","repaint","noiseScale","repaintWithNoise","animatedNoise","prettyHexesClick","staticNoise","wallsView","makeWallsView","wallsSprites","makeMap","makeWalls","config","refillPerSecond","makeSyncPeers","collectors","callbacks","all","views","effectViews","effectSprites","effectSprite","anchor","ind","removeBoid","onTopScored","onBottomScored","makeCollectors","updateBar","bar","makeFillbars","syncPeers","App","canvasRef","useRef","TimeCountdown_TimeCountdown","ref","Hud_Hud","ReactDOM","render","src_App","getElementById"],"mappings":"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AAI+K,KAAKyH,EAAIA,+BAErBxS,EAAWwS,EAAWwP,GAC9B,OAAOjX,KAAK/K,EAAIA,EAAI+K,KAAKyH,EAAIA,EAAIzH,KAAKiX,EAAIA,WAI5CC,GAAQ,CACV,IAAIF,GAAK,EAAG,EAAG,GACf,IAAIA,IAAM,EAAG,EAAG,GAChB,IAAIA,GAAK,GAAI,EAAG,GAChB,IAAIA,IAAM,GAAI,EAAG,GACjB,IAAIA,GAAK,EAAG,EAAG,GACf,IAAIA,IAAM,EAAG,EAAG,GAChB,IAAIA,GAAK,EAAG,GAAI,GAChB,IAAIA,IAAM,EAAG,GAAI,GACjB,IAAIA,GAAK,EAAG,EAAG,GACf,IAAIA,GAAK,GAAI,EAAG,GAChB,IAAIA,GAAK,EAAG,GAAI,GAChB,IAAIA,GAAK,GAAI,GAAI,IAGfphB,GAAI,CACN,IACA,IACA,IACA,GACA,GACA,GACA,IACA,GACA,IACA,GACA,GACA,GACA,IACA,IACA,EACA,IACA,IACA,GACA,IACA,GACA,GACA,IACA,EACA,GACA,GACA,IACA,GACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,GACA,EACA,GACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,IACA,GACA,IACA,GACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,EACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,EACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,EACA,IACA,GACA,GACA,IACA,GACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,EACA,IACA,IACA,IACA,IACA,IACA,GACA,IACA,IACA,GACA,GACA,GACA,GACA,IACA,IACA,IACA,IACA,GACA,GACA,IACA,GACA,IACA,KAGEuhB,GAAO,IAAI1R,MAAM,KACjB2R,GAAQ,IAAI3R,MAAM,KAiClB4R,IAJYliB,KAAKgV,KAAK,GACZhV,KAAKgV,KAAK,GAGf,EAAI,GAiEFmN,GAAW,SAACC,EAAaC,EAAaC,GAC/C,IAeIC,EAAIC,EAAIC,EACRC,EAAIC,EAAIC,EAbN9hB,GAAKshB,EAAMC,EAAMC,IAtEhB,EAAI,GAuEP3R,EAAI3Q,KAAK4Q,MAAMwR,EAAMthB,GACrB+hB,EAAI7iB,KAAK4Q,MAAMyR,EAAMvhB,GACrBib,EAAI/b,KAAK4Q,MAAM0R,EAAMxhB,GAEnBH,GAAKgQ,EAAIkS,EAAI9G,GAAKmG,GAClBY,EAAKV,EAAMzR,EAAIhQ,EACfoiB,EAAKV,EAAMQ,EAAIliB,EACfqiB,EAAKV,EAAMvG,EAAIpb,EAMjBmiB,GAAMC,EACFA,GAAMC,GACNT,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,GACEE,GAAME,GACbT,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,IAELL,EAAK,EACLC,EAAK,EACLC,EAAK,EACLC,EAAK,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","file":"static/js/main.60979523.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 39;","import {IBoid} from \"./../boids/makeBoids\";\r\nimport {ITime} from \"utils/loop/timeVariableLoop\";\r\nimport {string} from \"prop-types\";\r\n\r\nexport enum GAME_STATE {\r\n    \"intro\" = \"intro\",\r\n    \"duel\" = \"duel\",\r\n    \"practice\" = \"practice\",\r\n    \"about\" = \"about\",\r\n    \"lobby\" = \"lobby\"\r\n}\r\n\r\nexport type LobbyStatus = \"peerless\" | \"connecting\" | \"connected\" | \"awaiting-peer-ready\";\r\nexport type ConnectonResult = {send: (data: PeerData) => void; peer: string};\r\nexport type LobbyState = {\r\n    peer: string;\r\n    ownId: string;\r\n    status: LobbyStatus;\r\n    ownPeerData: PeerData;\r\n    otherPeerData: PeerData;\r\n    connectTo?: (id: string) => Promise<ConnectonResult>;\r\n    send?: (data: PeerData) => void;\r\n};\r\n\r\nexport type GameState = {\r\n    gameState: GAME_STATE;\r\n    score: {top: number; bottom: number};\r\n    colors: {top: number; bottom: number};\r\n    fillbars: {max: number; top: number; bottom: number};\r\n    actions: {reset?: () => void; startGame?: () => void; endGame?: () => void};\r\n    time: ITime;\r\n    duration: number;\r\n    maxDuration: number;\r\n    isGameOver: boolean;\r\n    lobbyState?: LobbyState;\r\n};\r\n\r\nexport type PeerBoid = IBoid & {node: number};\r\n\r\nexport type PeerData = {\r\n    isOP?: boolean;\r\n    isReady?: boolean;\r\n    nodesTouched?: number[];\r\n    boids?: PeerBoid[];\r\n    timeLeft?: number;\r\n};\r\n","/* eslint-disable no-unused-expressions */\r\n/* eslint-disable no-sequences */\r\nconst letters = \"0123456789ABCDEF\";\r\n\r\nexport function randomColor() {\r\n    let color = \"0x\";\r\n    for (let i = 0; i < 6; i++) {\r\n        color += letters[Math.floor(Math.random() * 16)];\r\n    }\r\n    return color;\r\n}\r\n\r\nexport function rgbArrayToHex(arr: any) {\r\n    if (arr.length !== 3) {\r\n        return 0x000000;\r\n    }\r\n    const r = arr[0];\r\n    const g = arr[1];\r\n    const b = arr[2];\r\n    const toHex = (x: any) => {\r\n        const hex = Math.round(x).toString(16);\r\n        return hex.length === 1 ? \"0\" + hex : hex;\r\n    };\r\n    return parseInt(`${toHex(r)}${toHex(g)}${toHex(b)}`, 16);\r\n}\r\n\r\nexport function rgbToHex(rgb: {r: number; g: number; b: number}) {\r\n    return rgbArrayToHex([rgb.r, rgb.g, rgb.b]);\r\n}\r\n\r\nexport function hexToRgb(hex: number) {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex.toString(16));\r\n    return result\r\n        ? {\r\n              r: parseInt(result[1], 16) || 0,\r\n              g: parseInt(result[2], 16) || 0,\r\n              b: parseInt(result[3], 16) || 0\r\n          }\r\n        : {r: 0, g: 0, b: 0};\r\n}\r\n\r\nexport function hexToRgbArray(hex: number) {\r\n    const rgb = hexToRgb(hex);\r\n    return [rgb.r, rgb.g, rgb.b];\r\n}\r\n\r\nexport function rgbToHexString(r: number, g: number, b: number) {\r\n    return \"#\" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\r\n}\r\n\r\nexport function hexStringToRgb(hex: string) {\r\n    // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n    const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n    hex = hex.replace(shorthandRegex, (m, r, g, b) => {\r\n        return r + r + g + g + b + b;\r\n    });\r\n\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result ? [parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)] : [0, 0, 0];\r\n}\r\n\r\n/**\r\n * Converts an RGB color value to HSL. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\r\n * Assumes r, g, and b are contained in the set [0, 255] and\r\n * returns h, s, and l in the set [0, 1].\r\n *\r\n * @param   Number  r       The red color value\r\n * @param   Number  g       The green color value\r\n * @param   Number  b       The blue color value\r\n * @return  Array           The HSL representation\r\n */\r\nexport function rgbToHsl(r: number, g: number, b: number) {\r\n    (r /= 255), (g /= 255), (b /= 255);\r\n\r\n    const max = Math.max(r, g, b),\r\n        min = Math.min(r, g, b);\r\n    let h,\r\n        s,\r\n        // tslint:disable-next-line:prefer-const\r\n        l = (max + min) / 2;\r\n\r\n    if (max === min) {\r\n        h = s = 0; // achromatic\r\n    } else {\r\n        const d = max - min;\r\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n\r\n        switch (max) {\r\n            case r:\r\n                h = (g - b) / d + (g < b ? 6 : 0);\r\n                break;\r\n            case g:\r\n                h = (b - r) / d + 2;\r\n                break;\r\n            case b:\r\n                h = (r - g) / d + 4;\r\n                break;\r\n        }\r\n\r\n        h && (h /= 6);\r\n    }\r\n\r\n    return [h || 0, s || 0, l || 0];\r\n}\r\n\r\nfunction hue2rgb(p: number, q: number, t: number) {\r\n    if (t < 0) t += 1;\r\n    if (t > 1) t -= 1;\r\n    if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n    if (t < 1 / 2) return q;\r\n    if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n    return p;\r\n}\r\n\r\n/**\r\n * Converts an HSL color value to RGB. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\r\n * Assumes h, s, and l are contained in the set [0, 1] and\r\n * returns r, g, and b in the set [0, 255].\r\n *\r\n * @param   Number  h       The hue\r\n * @param   Number  s       The saturation\r\n * @param   Number  l       The lightness\r\n * @return  Array           The RGB representation\r\n */\r\nexport function hslToRgb(h: number, s: number, l: number) {\r\n    let r, g, b;\r\n\r\n    if (s === 0) {\r\n        r = g = b = l; // achromatic\r\n    } else {\r\n        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n        const p = 2 * l - q;\r\n\r\n        r = hue2rgb(p, q, h + 1 / 3);\r\n        g = hue2rgb(p, q, h);\r\n        b = hue2rgb(p, q, h - 1 / 3);\r\n    }\r\n\r\n    return [r * 255, g * 255, b * 255];\r\n}\r\n\r\n/**\r\n * Converts an RGB color value to HSV. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSV_color_space.\r\n * Assumes r, g, and b are contained in the set [0, 255] and\r\n * returns h, s, and v in the set [0, 1].\r\n *\r\n * @param   Number  r       The red color value\r\n * @param   Number  g       The green color value\r\n * @param   Number  b       The blue color value\r\n * @return  Array           The HSV representation\r\n */\r\nexport function rgbToHsv(r: number, g: number, b: number) {\r\n    (r /= 255), (g /= 255), (b /= 255);\r\n\r\n    const max = Math.max(r, g, b),\r\n        min = Math.min(r, g, b);\r\n    let h,\r\n        s,\r\n        // tslint:disable-next-line:prefer-const\r\n        v = max;\r\n\r\n    const d = max - min;\r\n    s = max === 0 ? 0 : d / max;\r\n\r\n    if (max === min) {\r\n        h = 0; // achromatic\r\n    } else {\r\n        switch (max) {\r\n            case r:\r\n                h = (g - b) / d + (g < b ? 6 : 0);\r\n                break;\r\n            case g:\r\n                h = (b - r) / d + 2;\r\n                break;\r\n            case b:\r\n                h = (r - g) / d + 4;\r\n                break;\r\n        }\r\n\r\n        h && (h /= 6);\r\n    }\r\n\r\n    return [h, s, v];\r\n}\r\n\r\n/**\r\n * Converts an HSV color value to RGB. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSV_color_space.\r\n * Assumes h, s, and v are contained in the set [0, 1] and\r\n * returns r, g, and b in the set [0, 255].\r\n *\r\n * @param   Number  h       The hue\r\n * @param   Number  s       The saturation\r\n * @param   Number  v       The value\r\n * @return  Array           The RGB representation\r\n */\r\nexport function hsvToRgb(h: number, s: number, v: number) {\r\n    let r, g, b;\r\n\r\n    const i = Math.floor(h * 6);\r\n    const f = h * 6 - i;\r\n    const p = v * (1 - s);\r\n    const q = v * (1 - f * s);\r\n    const t = v * (1 - (1 - f) * s);\r\n\r\n    switch (i % 6) {\r\n        case 0:\r\n            (r = v), (g = t), (b = p);\r\n            break;\r\n        case 1:\r\n            (r = q), (g = v), (b = p);\r\n            break;\r\n        case 2:\r\n            (r = p), (g = v), (b = t);\r\n            break;\r\n        case 3:\r\n            (r = p), (g = q), (b = v);\r\n            break;\r\n        case 4:\r\n            (r = t), (g = p), (b = v);\r\n            break;\r\n        case 5:\r\n            (r = v), (g = p), (b = q);\r\n            break;\r\n    }\r\n\r\n    return [r || 1 * 255, g || 1 * 255, b || 1 * 255];\r\n}\r\n\r\nexport function hexValueToString(value: number) {\r\n    let hueString = value.toString(16);\r\n    while (hueString.length < 6) {\r\n        hueString = \"0\" + hueString;\r\n    }\r\n    hueString = \"#\" + hueString;\r\n    return hueString;\r\n}\r\n","import React, {useState, useEffect} from \"react\";\r\n\r\nexport const Button = (p: {\r\n    title: string;\r\n    onClick?: () => void;\r\n    colors?: {default: string; hover: string; down: string};\r\n    style?: any;\r\n    textStyle?: any;\r\n    children?: any;\r\n    disabled?: boolean;\r\n}) => {\r\n    const styleDefault = {\r\n        width: \"300px\",\r\n        height: \"60px\",\r\n        backgroundColor: p.colors ? p.colors.default : \"#ffff80\",\r\n        display: \"grid\",\r\n        transition: \"all 0.15s ease-in\",\r\n        ...p.style\r\n    };\r\n    const [isDown, setisDown] = useState(false);\r\n    const [isHover, setIsHover] = useState(false);\r\n    const [style, setStyle] = useState(styleDefault);\r\n    const colorDown = p.colors ? p.colors.down : \"green\";\r\n    const colorHover = p.colors ? p.colors.hover : \"lightgrey\";\r\n\r\n    useEffect(() => {\r\n        if (p.disabled) {\r\n            setStyle({...styleDefault, color: \"darkgrey\", backgroundColor: \"lightgrey\", pointerEvents: \"none\"});\r\n            return;\r\n        }\r\n        if (isDown) {\r\n            setStyle({...styleDefault, backgroundColor: colorDown});\r\n            return;\r\n        }\r\n        if (isHover) {\r\n            setStyle({...styleDefault, backgroundColor: colorHover});\r\n            return;\r\n        }\r\n        setStyle({...styleDefault});\r\n    }, [isDown, isHover, colorDown, colorHover, styleDefault, p.disabled]);\r\n\r\n    return (\r\n        <div\r\n            onMouseEnter={() => setIsHover(true)}\r\n            onMouseLeave={() => {\r\n                setIsHover(false);\r\n                setisDown(false);\r\n            }}\r\n            onMouseDown={() => setisDown(true)}\r\n            onMouseUp={() => setisDown(false)}\r\n            onTouchStart={() => setisDown(true)}\r\n            onTouchEnd={() => setisDown(false)}\r\n            onClick={p.onClick}\r\n            style={style}>\r\n            <div\r\n                style={{\r\n                    color: \"black\",\r\n                    gridRow: 1,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\",\r\n                    fontWeight: 600,\r\n                    fontSize: \"28pt\",\r\n                    padding: \"8px\",\r\n                    userSelect: \"none\",\r\n                    ...p.textStyle\r\n                }}>\r\n                {p.title}\r\n            </div>\r\n            {p.children}\r\n        </div>\r\n    );\r\n};\r\n","import React from \"react\";\r\nimport {Button} from \"components/common/Button\";\r\nimport {GameState, GAME_STATE} from \"components/types\";\r\n\r\nexport const PracticeOver = (p: {data: GameState}) => {\r\n    const {data} = p;\r\n    return (\r\n        <div\r\n            style={{\r\n                height: `${window.innerHeight}px`,\r\n                width: `${window.innerWidth}px`,\r\n                display: \"grid\",\r\n                gridTemplateRows: \"1fr 1fr 1fr\",\r\n                gridTemplateColumns: \"1fr\"\r\n            }}>\r\n            <div\r\n                style={{\r\n                    gridRow: 1,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\",\r\n                    fontWeight: 600,\r\n                    color: \"red\",\r\n                    fontSize: \"32pt\"\r\n                }}>\r\n                {`GAME OVER`}\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 2,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <Button\r\n                    {...{\r\n                        title: \"AGAIN!\",\r\n                        onClick: () => {\r\n                            data.actions.startGame && data.actions.startGame();\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 3,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <Button\r\n                    {...{\r\n                        title: \"BACK\",\r\n                        onClick: () => {\r\n                            data.gameState = GAME_STATE.intro;\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, {useState, useEffect} from \"react\";\r\nimport {GameState, GAME_STATE} from \"../types\";\r\nimport {hexValueToString} from \"utils/colorConversions\";\r\nimport {autorun} from \"mobx\";\r\nimport {Button} from \"components/common/Button\";\r\nimport {PracticeOver} from \"./PracticeOver\";\r\n\r\nconst fontStyle = {\r\n    textShadow: \"-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000\",\r\n    position: \"fixed\" as \"fixed\",\r\n    fontSize: \"24pt\"\r\n};\r\n\r\nexport const HudPractice = (p: {data: GameState}) => {\r\n    const {data} = p;\r\n    const [topValue, settopValue] = useState(p.data.score.top);\r\n\r\n    useEffect(() => {\r\n        return autorun(() => settopValue(p.data.score.top));\r\n    }, [p.data.score.top]);\r\n\r\n    const [topFillbarValue, settopFillbarValue] = useState(p.data.fillbars.top / p.data.fillbars.max);\r\n\r\n    useEffect(() => {\r\n        return autorun(() => settopFillbarValue(p.data.fillbars.top / p.data.fillbars.max));\r\n    }, []);\r\n    const [isGameOver, setisGameOver] = useState(p.data.isGameOver);\r\n\r\n    useEffect(() => {\r\n        return autorun(() => setisGameOver(p.data.isGameOver));\r\n    }, []);\r\n    const getStringVal = (v: number) => (v > 9 ? v : `0${v}`);\r\n    const maxWidth = window.innerWidth - 120;\r\n    const topColor = hexValueToString(data.colors.top);\r\n    return (\r\n        <div>\r\n            {isGameOver && <PracticeOver {...{data}} />}\r\n            <div style={{...fontStyle, top: 4, left: 4, color: topColor}}>{getStringVal(topValue)}</div>\r\n            <div\r\n                style={{\r\n                    position: \"fixed\",\r\n                    top: 8,\r\n                    height: 16,\r\n                    left: 90,\r\n                    width: topFillbarValue * maxWidth,\r\n                    backgroundColor: topColor\r\n                }}\r\n            />\r\n            {!isGameOver && (\r\n                <Button\r\n                    {...{\r\n                        title: \"BACK\",\r\n                        onClick: () => {\r\n                            console.log(\"BACK\");\r\n                            p.data.gameState = GAME_STATE.intro;\r\n                        },\r\n                        style: {\r\n                            margin: \"8px\",\r\n                            left: 0,\r\n                            width: \"calc(100% - 16px)\",\r\n                            height: \"32px\",\r\n                            position: \"fixed\",\r\n                            bottom: 0\r\n                        },\r\n                        textStyle: {fontSize: \"16pt\"}\r\n                    }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","import React from \"react\";\r\nimport {Button} from \"components/common/Button\";\r\nimport {GameState, GAME_STATE} from \"components/types\";\r\n\r\nexport const DuelOver = (p: {data: GameState}) => {\r\n    const {data} = p;\r\n    return (\r\n        <div\r\n            style={{\r\n                height: `${window.innerHeight}px`,\r\n                width: `${window.innerWidth}px`,\r\n                display: \"grid\",\r\n                gridTemplateRows: \"1fr 1fr 1fr\",\r\n                gridTemplateColumns: \"1fr\"\r\n            }}>\r\n            <div\r\n                style={{\r\n                    gridRow: 1,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\",\r\n                    fontWeight: 600,\r\n                    color: \"red\",\r\n                    fontSize: \"28pt\"\r\n                }}>\r\n                {`GAME OVER`}\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 2,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <Button\r\n                    {...{\r\n                        title: \"AGAIN!\",\r\n                        onClick: () => {\r\n                            data.actions.startGame && data.actions.startGame();\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 3,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <Button\r\n                    {...{\r\n                        title: \"BACK\",\r\n                        onClick: () => {\r\n                            data.actions.reset && data.actions.reset();\r\n                            data.gameState = GAME_STATE.lobby;\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React, {useState, useEffect} from \"react\";\r\nimport {GameState} from \"../types\";\r\nimport {hexValueToString} from \"utils/colorConversions\";\r\nimport {autorun} from \"mobx\";\r\nimport {DuelOver} from \"./DuelOver\";\r\n\r\nconst fontStyle = {\r\n    textShadow: \"-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000\",\r\n    position: \"fixed\" as \"fixed\",\r\n    fontSize: \"24pt\"\r\n};\r\n\r\nexport const HudDuel = (p: {data: GameState}) => {\r\n    const {data} = p;\r\n    const [bottomValue, setBottomValue] = useState(p.data.score.bottom);\r\n    const [topValue, settopValue] = useState(p.data.score.top);\r\n    useEffect(() => {\r\n        return autorun(() => setBottomValue(p.data.score.bottom));\r\n    }, [p.data.score.bottom]);\r\n    useEffect(() => {\r\n        return autorun(() => settopValue(p.data.score.top));\r\n    }, [p.data.score.top]);\r\n\r\n    const [bottomFillbarValue, setBottomFillbarValue] = useState(p.data.fillbars.bottom / p.data.fillbars.max);\r\n    const [topFillbarValue, settopFillbarValue] = useState(p.data.fillbars.top / p.data.fillbars.max);\r\n    useEffect(() => {\r\n        return autorun(() => setBottomFillbarValue(p.data.fillbars.bottom / p.data.fillbars.max));\r\n    }, [p.data.fillbars.bottom, p.data.fillbars.max]);\r\n    useEffect(() => {\r\n        return autorun(() => settopFillbarValue(p.data.fillbars.top / p.data.fillbars.max));\r\n    }, [p.data.fillbars.top, p.data.fillbars.max]);\r\n\r\n    const [isGameOver, setisGameOver] = useState(p.data.isGameOver);\r\n\r\n    useEffect(() => {\r\n        return autorun(() => setisGameOver(p.data.isGameOver));\r\n    }, []);\r\n\r\n    const getStringVal = (v: number) => (v > 9 ? v : `0${v}`);\r\n    const maxWidth = window.innerWidth - 120;\r\n    const topColor = hexValueToString(data.colors.top);\r\n    const bottomColor = hexValueToString(data.colors.bottom);\r\n    return (\r\n        <div>\r\n            {isGameOver && <DuelOver {...{data}} />}\r\n            <div style={{...fontStyle, top: 4, left: 4, color: topColor}}>{getStringVal(topValue)}</div>\r\n            <div\r\n                style={{\r\n                    position: \"fixed\",\r\n                    top: 8,\r\n                    height: 16,\r\n                    left: 90,\r\n                    width: topFillbarValue * maxWidth,\r\n                    backgroundColor: topColor\r\n                }}\r\n            />\r\n            <div style={{...fontStyle, bottom: 4, right: 4, color: bottomColor}}>{getStringVal(bottomValue)}</div>\r\n            <div\r\n                style={{\r\n                    position: \"fixed\",\r\n                    bottom: 8,\r\n                    height: 16,\r\n                    right: 90,\r\n                    width: bottomFillbarValue * maxWidth,\r\n                    backgroundColor: bottomColor\r\n                }}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n","import React, {useState, useEffect} from \"react\";\r\nimport {GameState, GAME_STATE} from \"components/types\";\r\nimport {autorun} from \"mobx\";\r\nimport {Button} from \"components/common/Button\";\r\n\r\nexport const IntroScreen = (p: {data: GameState}) => {\r\n    const {data} = p;\r\n    const [isVisible, setisVisible] = useState(data.gameState === GAME_STATE.intro);\r\n\r\n    useEffect(() => {\r\n        return autorun(() => {\r\n            setisVisible(data.gameState === GAME_STATE.intro);\r\n        });\r\n    }, [data.gameState]);\r\n\r\n    return !isVisible ? null : (\r\n        <div\r\n            style={{\r\n                height: `${window.innerHeight}px`,\r\n                width: `${window.innerWidth}px`,\r\n                display: \"grid\",\r\n                gridTemplateRows: \"1fr 1fr 1fr 1fr\",\r\n                gridTemplateColumns: \"1fr\",\r\n                backgroundColor: \"black\"\r\n            }}>\r\n            <div\r\n                style={{\r\n                    gridRow: 1,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\",\r\n                    fontWeight: 600,\r\n                    color: \"#80c0ff\",\r\n                    fontSize: \"32pt\"\r\n                }}>\r\n                {`SKEDADDLE`}\r\n            </div>\r\n\r\n            <div\r\n                style={{\r\n                    gridRow: 2,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <Button\r\n                    {...{\r\n                        title: \"PRACTICE\",\r\n                        onClick: () => {\r\n                            data.gameState = GAME_STATE.practice;\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 3,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <Button\r\n                    {...{\r\n                        title: \"DUEL!\",\r\n                        onClick: () => {\r\n                            data.gameState = GAME_STATE.lobby;\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 4,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <Button\r\n                    {...{\r\n                        title: \"WHAT?\",\r\n                        onClick: () => {\r\n                            data.gameState = GAME_STATE.about;\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","import React from \"react\";\r\nimport {GameState, GAME_STATE} from \"components/types\";\r\nimport {Button} from \"components/common/Button\";\r\n\r\nexport const About = (p: {data: GameState}) => {\r\n    return (\r\n        <div\r\n            style={{\r\n                height: `${window.innerHeight}px`,\r\n                width: `${window.innerWidth}px`,\r\n                display: \"grid\",\r\n                gridTemplateRows: \"100px 1fr 1fr 1fr 1fr\",\r\n                gridTemplateColumns: \"1fr\",\r\n                backgroundColor: \"black\"\r\n            }}>\r\n            <div\r\n                style={{\r\n                    gridRow: 1,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"end\",\r\n                    justifySelf: \"center\",\r\n                    fontWeight: 600,\r\n                    color: \"#80c0ff\",\r\n                    fontSize: \"32pt\"\r\n                }}>\r\n                {`SKEDADDLE`}\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 2,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <div\r\n                    style={{\r\n                        gridRow: 1,\r\n                        gridColumn: 1,\r\n                        alignSelf: \"center\",\r\n                        justifySelf: \"center\",\r\n                        fontWeight: 400,\r\n                        color: \"white\",\r\n                        fontSize: \"16pt\",\r\n                        textAlign: \"center\",\r\n                        whiteSpace: \"pre-line\",\r\n                        paddingLeft: \"8px\",\r\n                        paddingRight: \"8px\"\r\n                    }}>\r\n                    {`a 2-player game by \r\n                    `}\r\n                    <span style={{fontSize: \"24pt\", color: \"#80ff80\"}}>{`Alex Tavor`}</span>\r\n                </div>\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 3,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <div\r\n                    style={{\r\n                        gridRow: 1,\r\n                        gridColumn: 1,\r\n                        alignSelf: \"center\",\r\n                        justifySelf: \"center\",\r\n                        fontWeight: 400,\r\n                        color: \"white\",\r\n                        fontSize: \"22pt\",\r\n                        textAlign: \"center\",\r\n                        whiteSpace: \"pre-line\",\r\n                        paddingRight: \"8px\",\r\n                        paddingLeft: \"8px\"\r\n                    }}>\r\n                    {`Duel by pushing things up with your finger!`}\r\n                </div>\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 4,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <div\r\n                    style={{\r\n                        gridRow: 1,\r\n                        gridColumn: 1,\r\n                        alignSelf: \"center\",\r\n                        justifySelf: \"center\",\r\n                        fontWeight: 400,\r\n                        color: \"white\",\r\n                        fontSize: \"22pt\",\r\n                        textAlign: \"center\",\r\n                        whiteSpace: \"pre-line\",\r\n                        paddingRight: \"8px\",\r\n                        paddingLeft: \"8px\"\r\n                    }}>\r\n                    {`Tell your friends!`}\r\n                </div>\r\n            </div>\r\n            <div\r\n                style={{\r\n                    gridRow: 5,\r\n                    gridColumn: 1,\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\"\r\n                }}>\r\n                <Button\r\n                    {...{\r\n                        title: \"BACK\",\r\n                        onClick: () => {\r\n                            p.data.gameState = GAME_STATE.intro;\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","// source: https://gist.github.com/jed/982883\r\nexport const uuid = (a?: any): string => {\r\n    return a\r\n        ? (a ^ ((Math.random() * 16) >> (a / 4))).toString(16)\r\n        : (`${1e7}` + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, uuid);\r\n};\r\n","import {seed} from \"./../../utils/simplexNoise\";\r\nimport {LobbyState, PeerData, ConnectonResult} from \"./../types\";\r\nimport {GameState, LobbyStatus} from \"../types\";\r\nimport {observable, action} from \"mobx\";\r\nimport {uuid} from \"utils/uuid\";\r\nimport {peerLogic} from \"./peerLogic\";\r\n\r\nexport const getLobbyState = (gameState: GameState) => {\r\n    if (!gameState.lobbyState) {\r\n        const lobbyState = observable({\r\n            peer: \"\",\r\n            status: \"peerless\" as LobbyStatus,\r\n            ownId: uuid(),\r\n            ownPeerData: {isReady: false, nodesTouched: []},\r\n            otherPeerData: {isReady: false, nodesTouched: []}\r\n        }) as any;\r\n        const connectTo = peerLogic({\r\n            state: lobbyState,\r\n            onConnection: (d: ConnectonResult) => {\r\n                lobbyState.peer = d.peer;\r\n                lobbyState.send = d.send;\r\n            },\r\n            onData: action((d: PeerData) => {\r\n                lobbyState.otherPeerData.isReady = d.isReady;\r\n                lobbyState.otherPeerData.nodesTouched = d.nodesTouched;\r\n                lobbyState.otherPeerData.boids = d.boids;\r\n            })\r\n        });\r\n        lobbyState.connectTo = connectTo;\r\n        gameState.lobbyState = lobbyState as LobbyState;\r\n    }\r\n    return gameState.lobbyState;\r\n};\r\n","import {LobbyState, PeerData, ConnectonResult} from \"./../types\";\r\nimport Peer from \"peerjs\";\r\n\r\nexport const peerLogic = (p: {\r\n    state: LobbyState;\r\n    onConnection: (data: ConnectonResult) => void;\r\n    onData: (data: PeerData) => void;\r\n}) => {\r\n    const {state, onData, onConnection} = p;\r\n\r\n    const peer = new Peer(state.ownId);\r\n\r\n    const connectTo = async (id: string) => {\r\n        return new Promise<ConnectonResult>((resolve, reject) => {\r\n            state.status = \"connecting\";\r\n            const conn = peer.connect(id);\r\n            conn.on(\"open\", () => {\r\n                state.status = \"connected\";\r\n                const send = conn.send.bind(conn);\r\n                onConnection({send, peer: conn.peer});\r\n                conn.on(\"data\", onData);\r\n                resolve({send, peer: conn.peer});\r\n            });\r\n        });\r\n    };\r\n\r\n    peer.on(\"connection\", conn => {\r\n        state.status = \"connected\";\r\n        const send = conn.send.bind(conn);\r\n        onConnection({send, peer: conn.peer});\r\n        conn.on(\"data\", onData);\r\n    });\r\n\r\n    return connectTo;\r\n};\r\n","import React, {useState, useEffect} from \"react\";\r\nimport {Button} from \"components/common/Button\";\r\nimport {GameState, GAME_STATE} from \"components/types\";\r\nimport {getLobbyState} from \"./getLobbyState\";\r\nimport {autorun} from \"mobx\";\r\nimport {ActionButton} from \"./ActionButton\";\r\nimport {copyToClipboard} from \"components/duel/copyToClipboard\";\r\n\r\nconst textStyle = {\r\n    gridColumn: 1,\r\n    placeSelf: \"center center\",\r\n    fontWeight: 400,\r\n    color: \"white\",\r\n    fontSize: \"16pt\",\r\n    textAlign: \"center\" as \"center\",\r\n    whiteSpace: \"pre-line\" as \"pre-line\",\r\n    paddingRight: \"8px\",\r\n    paddingLeft: \"8px\",\r\n    paddingBottom: \"8px\"\r\n};\r\n\r\nconst rowStyle = (gridRow: number = 1) => ({\r\n    height: \"100%\",\r\n    gridRow,\r\n    gridColumn: 1,\r\n    placeSelf: \"center center\",\r\n    display: \"grid\"\r\n});\r\n\r\nexport const Lobby = (p: {data: GameState}) => {\r\n    const {data} = p;\r\n    const state = getLobbyState(p.data);\r\n    const [friendKey, setfriendKey] = useState(state.peer);\r\n    useEffect(() => {\r\n        return autorun(() => {\r\n            setfriendKey(state.peer);\r\n        });\r\n    }, []);\r\n\r\n    const [status, setStatus] = useState(state.status);\r\n    useEffect(() => {\r\n        return autorun(() => {\r\n            setStatus(state.status);\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <div\r\n            style={{\r\n                height: `${window.innerHeight}px`,\r\n                width: `${window.innerWidth}px`,\r\n                display: \"grid\",\r\n                gridTemplateRows: \"1fr 1fr 1fr 1fr 1fr\",\r\n                gridTemplateColumns: \"1fr\",\r\n                backgroundColor: \"black\"\r\n            }}>\r\n            <div\r\n                style={{\r\n                    gridRow: 1,\r\n                    gridColumn: 1,\r\n                    placeSelf: \"center center\",\r\n                    fontWeight: 600,\r\n                    color: \"#80c0ff\",\r\n                    textShadow: \"-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000\",\r\n                    fontSize: \"32pt\"\r\n                }}>\r\n                {`LOBBY`}\r\n            </div>\r\n            <div style={rowStyle(2)}>\r\n                <div style={textStyle}>\r\n                    <div style={{color: \"#80ff80\"}}>{`Your key`}</div>\r\n                    <div style={{paddingTop: \"32px\"}} onClick={() => copyToClipboard(state.ownId)}>\r\n                        {state.ownId}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div style={rowStyle(3)}>\r\n                <div style={{...textStyle, color: \"#80ff80\"}}>{`Enter friend's key`}</div>\r\n            </div>\r\n            <div style={rowStyle(4)}>\r\n                <input\r\n                    type=\"text\"\r\n                    onChange={e => setfriendKey(e.target.value)}\r\n                    value={friendKey}\r\n                    style={{...textStyle, color: \"black\", height: \"32px\", width: \"340px\"}}\r\n                />\r\n                {ActionButton({data, friendKey, status})}\r\n            </div>\r\n            <div style={rowStyle(5)}>\r\n                <Button\r\n                    {...{\r\n                        style: {placeSelf: \"center center\"},\r\n                        title: \"BACK\",\r\n                        onClick: () => {\r\n                            data.gameState = GAME_STATE.intro;\r\n                        }\r\n                    }}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","export const copyToClipboard = str => {\r\n    const el = document.createElement(\"textarea\");\r\n    el.value = str;\r\n    el.setAttribute(\"readonly\", \"\");\r\n    el.style.position = \"absolute\";\r\n    el.style.left = \"-9999px\";\r\n    document.body.appendChild(el);\r\n    const selected = document.getSelection().rangeCount > 0 ? document.getSelection().getRangeAt(0) : false;\r\n    el.select();\r\n    document.execCommand(\"copy\");\r\n    document.body.removeChild(el);\r\n    if (selected) {\r\n        document.getSelection().removeAllRanges();\r\n        document.getSelection().addRange(selected);\r\n    }\r\n};\r\n","import React, {useState, useEffect} from \"react\";\r\nimport {Button} from \"components/common/Button\";\r\nimport {GameState, GAME_STATE, LobbyStatus} from \"components/types\";\r\nimport {getLobbyState} from \"./getLobbyState\";\r\nimport {action, autorun} from \"mobx\";\r\nexport const ActionButton = (p: {data: GameState; friendKey: string; status: LobbyStatus}) => {\r\n    const {data, friendKey, status} = p;\r\n    const state = getLobbyState(data);\r\n    useEffect(() => {\r\n        return autorun(() => {\r\n            state.otherPeerData.isReady && state.status === \"awaiting-peer-ready\" && (data.gameState = GAME_STATE.duel);\r\n        });\r\n    }, []);\r\n    let reply = null;\r\n    switch (status) {\r\n        case \"peerless\":\r\n            reply = (\r\n                <Button\r\n                    style={{marginTop: \"32px\", placeSelf: \"center center\"}}\r\n                    {...{\r\n                        disabled: !Boolean(friendKey),\r\n                        title: \"JOIN\",\r\n                        onClick: action(async () => {\r\n                            if (state.connectTo) {\r\n                                const reply = await state.connectTo(friendKey);\r\n                                state.ownPeerData.isOP = true;\r\n                                state.peer = reply.peer;\r\n                                state.send = reply.send;\r\n                                state.status = \"awaiting-peer-ready\";\r\n                                state.send({isReady: true});\r\n                            }\r\n                        })\r\n                    }}\r\n                />\r\n            );\r\n            break;\r\n        case \"connecting\":\r\n            reply = (\r\n                <Button\r\n                    style={{marginTop: \"32px\", placeSelf: \"center center\"}}\r\n                    {...{\r\n                        disabled: true,\r\n                        title: \"DUEL!\"\r\n                    }}\r\n                />\r\n            );\r\n            break;\r\n        case \"connected\":\r\n            reply = (\r\n                <Button\r\n                    style={{marginTop: \"32px\", placeSelf: \"center center\"}}\r\n                    {...{\r\n                        title: \"DUEL!\",\r\n                        onClick: async () => {\r\n                            if (state.connectTo) {\r\n                                console.log(state.send ? \"sending is ready true\" : \"no send found\");\r\n                                state.send && state.send({isReady: true});\r\n                                data.gameState = GAME_STATE.duel;\r\n                            }\r\n                        }\r\n                    }}\r\n                />\r\n            );\r\n            break;\r\n        case \"awaiting-peer-ready\":\r\n            reply = (\r\n                <Button\r\n                    style={{marginTop: \"32px\", placeSelf: \"center center\"}}\r\n                    {...{\r\n                        disabled: true,\r\n                        title: \"WAITING\"\r\n                    }}\r\n                />\r\n            );\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    return reply;\r\n};\r\n","import React, {useRef, useEffect, useState} from \"react\";\r\nimport {HudPractice} from \"components/practice/HudPractice\";\r\nimport {GAME_STATE} from \"components/types\";\r\nimport {GameState} from \"./types\";\r\nimport {HudDuel} from \"./duel/HudDuel\";\r\nimport {IntroScreen} from \"./intro/IntroScreen\";\r\nimport {autorun} from \"mobx\";\r\nimport {About} from \"./info/About\";\r\nimport {Lobby} from \"./lobby/Lobby\";\r\n\r\nexport const Hud = (p: {gameState: GameState}) => {\r\n    let hud = undefined;\r\n    const [gameState, setgameState] = useState(p.gameState.gameState);\r\n\r\n    useEffect(() => {\r\n        return autorun(() => setgameState(p.gameState.gameState));\r\n    }, []);\r\n    switch (gameState) {\r\n        case GAME_STATE.practice:\r\n            hud = <HudPractice {...{data: p.gameState}} />;\r\n            break;\r\n        case GAME_STATE.duel:\r\n            hud = <HudDuel {...{data: p.gameState}} />;\r\n            break;\r\n        case GAME_STATE.intro:\r\n            hud = <IntroScreen {...{data: p.gameState}} />;\r\n            break;\r\n        case GAME_STATE.about:\r\n            hud = <About {...{data: p.gameState}} />;\r\n            break;\r\n        case GAME_STATE.lobby:\r\n            hud = <Lobby {...{data: p.gameState}} />;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    return <div style={{position: \"fixed\"}}>{hud}</div>;\r\n};\r\n","import React, {useState, useEffect} from \"react\";\r\nimport {GameState, GAME_STATE} from \"components/types\";\r\nimport {autorun} from \"mobx\";\r\n\r\nexport const TimeCountdown = (p: {data: GameState}) => {\r\n    const [isGameOver, setisGameOver] = useState(p.data.isGameOver);\r\n    useEffect(() => {\r\n        return autorun(() => setisGameOver(p.data.isGameOver));\r\n    }, [p.data.isGameOver]);\r\n    const [isTimed, setisTimed] = useState(p.data.gameState === GAME_STATE.duel);\r\n    useEffect(() => {\r\n        return autorun(() => setisTimed(p.data.gameState === GAME_STATE.duel));\r\n    }, [p.data.gameState]);\r\n\r\n    const tLeft = Math.ceil(p.data.maxDuration - p.data.duration);\r\n    const [secondsLeft, setsecondsLeft] = useState(Math.max(0, tLeft));\r\n\r\n    useEffect(() => {\r\n        return autorun(() => {\r\n            if (!isTimed || isGameOver) return;\r\n            const tLeft = Math.ceil(p.data.maxDuration - p.data.duration);\r\n            setsecondsLeft(Math.max(0, tLeft));\r\n\r\n            if (tLeft <= 0) {\r\n                p.data.actions.endGame && p.data.actions.endGame();\r\n            }\r\n        });\r\n    }, [isTimed, isGameOver]);\r\n    return !isTimed || isGameOver ? null : (\r\n        <div\r\n            style={{\r\n                position: \"absolute\",\r\n                height: `${window.innerHeight}px`,\r\n                width: `${window.innerWidth}px`,\r\n                display: \"grid\",\r\n                gridTemplateRows: \"1fr\",\r\n                gridTemplateColumns: \"1fr\",\r\n                pointerEvents: \"none\",\r\n                touchAction: \"none\"\r\n            }}>\r\n            <div\r\n                style={{\r\n                    alignSelf: \"center\",\r\n                    justifySelf: \"center\",\r\n                    textAlign: \"center\",\r\n                    fontWeight: 600,\r\n                    color: \"#ffff80\",\r\n                    fontSize: \"64pt\",\r\n                    pointerEvents: \"none\",\r\n                    touchAction: \"none\"\r\n                }}>\r\n                {secondsLeft}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","/**\r\n * Starts an animation loop\r\n * @param callback - function to call with every tick\r\n * @returns cancel - cancellation function\r\n */\r\nexport function animationLoop(callback: () => void) {\r\n    let id = 0;\r\n    (function l() {\r\n        id = window.requestAnimationFrame(l);\r\n        callback();\r\n    })();\r\n    return () => {\r\n        window.cancelAnimationFrame(id);\r\n    };\r\n}\r\n","import {animationLoop} from \"./animationLoop\";\r\n\r\nlet current = Date.now();\r\n\r\nexport default function deltaLoop(callback: (delta: number) => void) {\r\n    const loop = () => {\r\n        const nc = Date.now();\r\n        const delta = (nc - current) / 1000;\r\n        current = nc;\r\n        callback(delta);\r\n    };\r\n    animationLoop(loop);\r\n}\r\n","import deltaLoop from \"./deltaLoop\";\r\n\r\nexport interface ITime {\r\n    speed: number;\r\n}\r\n\r\nexport default function timeVariableLoop(time: ITime, callback: (delta: number) => void) {\r\n    const loop = (d: number) => {\r\n        callback(d * time.speed);\r\n    };\r\n    deltaLoop(loop);\r\n}\r\n","import {randomColor} from \"../../utils/colorConversions\";\r\nimport {Texture, ParticleContainer, Sprite} from \"pixi.js\";\r\n\r\nexport function makeBoidsViews(tex: Texture, quantity: number, tint: number = 0xaa0000, maxBoids: number = 200) {\r\n    const view = new ParticleContainer(maxBoids, {\r\n        uvs: true,\r\n        tint: true,\r\n        position: true,\r\n        rotation: true,\r\n        vertices: true\r\n    });\r\n    const sprites = Array.from({length: quantity}, () => {\r\n        const sprite = new Sprite(tex);\r\n        view.addChild(sprite);\r\n        sprite.tint = parseInt(randomColor(), 16); // tint;\r\n        // sprite.anchor.set(0.275, 0.5);\r\n        return sprite;\r\n    });\r\n\r\n    return {view, sprites};\r\n}\r\n","import * as Tween from \"es6-tween\";\r\n\r\nexport const collectorTouchedTween = ({sprite, duration = 300}) => {\r\n    Tween.autoPlay(true);\r\n    sprite.scale.set(1, 1);\r\n    sprite.alpha = 1;\r\n    const t = new Tween.Tween({scale: 1, alpha: 1})\r\n        .to({scale: 6, alpha: 0}, duration)\r\n        .start()\r\n        .easing(Tween.Easing.Quadratic.Out)\r\n        .on(\"update\", v => {\r\n            sprite.scale.set(v.scale, v.scale);\r\n            sprite.alpha = v.alpha;\r\n        });\r\n    return t;\r\n};\r\n","import {ClickEventData} from \"pixi-viewport\";\r\nimport {IPoint} from \"./../utils/geom\";\r\nimport {IDisplay} from \"./types\";\r\nimport Grid from \"../scentmap/hexgrid/Grid\";\r\n\r\nlet isDragging = false;\r\n\r\nexport default function addDisplayDragListener(\r\n    display: IDisplay,\r\n    grid: Grid,\r\n    onStart: (node: number) => void,\r\n    onEnd: (node: number) => void,\r\n    onMove: (node: number) => void\r\n) {\r\n    const hs = grid.gridLayout.hexSize * 0.75;\r\n    const getNodeByPixel = (point: IPoint) => grid.getHexIdByPixel({x: point.x - hs, y: point.y - hs});\r\n\r\n    const dragStart = (data: ClickEventData) => {\r\n        isDragging = true;\r\n        onStart(getNodeByPixel(data.world));\r\n    };\r\n    const dragEnd = (data: ClickEventData) => {\r\n        isDragging = false;\r\n        onEnd(getNodeByPixel(data.world));\r\n    };\r\n    const onMouseMove = (e: MouseEvent) => {\r\n        if (!isDragging) return;\r\n        const node = getNodeByPixel(display.camera.toWorld(e.x, e.y));\r\n        if (isNaN(node)) return;\r\n        onMove(node);\r\n    };\r\n\r\n    const onTouchMove = (data: PIXI.interaction.InteractionEvent) => {\r\n        const position = data.data.global;\r\n        const node = getNodeByPixel(display.camera.toWorld(position.x, position.y));\r\n        if (isNaN(node)) return;\r\n        onMove(node);\r\n    };\r\n\r\n    display.camera.on(\"drag-start\", dragStart);\r\n    display.camera.on(\"drag-end\", dragEnd);\r\n    display.camera.on(\"touchmove\", onTouchMove);\r\n    document.addEventListener(\"mousemove\", onMouseMove);\r\n}\r\n","import addDisplayClickListener from \"pixi/addDisplayClickListener\";\r\nimport addDisplayDragListener from \"pixi/addDisplayDragListener\";\r\nimport {IDisplay} from \"pixi/types\";\r\nimport Grid from \"scentmap/hexgrid/Grid\";\r\n\r\nexport function addDropFunctionality(\r\n    display: IDisplay,\r\n    grid: Grid,\r\n    onDrag: (node: number) => void,\r\n    onTap: (node: number) => void,\r\n    onStart: () => void,\r\n    onEnd: () => void\r\n) {\r\n    addDisplayClickListener(display, grid, onTap);\r\n    // const onStart: (node: number) => void = (node: number) => {\r\n    //     // display.camera.pausePlugin(\"drag\");\r\n    // };\r\n    // const onEnd: (node: number) => void = (node: number) => {\r\n    //     // display.camera.resumePlugin(\"drag\");\r\n    // };\r\n    const onMove: (node: number) => void = onDrag;\r\n    addDisplayDragListener(display, grid, onStart, onEnd, onMove);\r\n}\r\n","import {ClickEventData} from \"pixi-viewport\";\r\nimport {IDisplay} from \"./types\";\r\nimport Grid from \"../scentmap/hexgrid/Grid\";\r\n\r\nexport default function addDisplayClickListener(display: IDisplay, grid: Grid, onClick: (node: number) => void) {\r\n    const hs = grid.gridLayout.hexSize * 0.75;\r\n    const onViewClicked = (data: ClickEventData) => {\r\n        const i = grid.getHexIdByPixel({x: data.world.x - hs, y: data.world.y - hs});\r\n        onClick(i);\r\n    };\r\n    display.camera.on(\"clicked\", onViewClicked);\r\n}\r\n","import {IScent} from \"./types\";\r\n\r\nexport default function makeScentDropper(scent: IScent, index: number, seconds: number = 0) {\r\n    let elapsed = 0;\r\n    const dropScent = (delta: number) => {\r\n        elapsed += delta;\r\n        scent.scentGrid[index] = Math.max(0, scent.scentGrid[index] + scent.quantity);\r\n        return elapsed < seconds;\r\n    };\r\n    return dropScent;\r\n}\r\n","import {GridMap} from \"types\";\r\nimport {IScent} from \"scentmap/scent/types\";\r\nimport {addDropFunctionality} from \"game/addDropFunctionality\";\r\nimport makeScentDropper from \"scentmap/scent/makeScentDropper\";\r\nimport {IDroppers} from \"./IDroppers\";\r\nimport {GameState} from \"components/types\";\r\n\r\nconst minDrop = 0.2;\r\nconst minTap = 0.001;\r\n\r\nexport const makeScentDroppers = (\r\n    gameState: GameState,\r\n    map: GridMap,\r\n    scent: IScent,\r\n    fillbars: {bars: {max: number; top: number; bottom: number}}\r\n) => {\r\n    const droppers: IDroppers = {updates: []};\r\n    let isDropping = false;\r\n    let lastDelta = 0;\r\n    const dropOwn = (node: number) => {\r\n        droppers.updates.push(makeScentDropper(scent, node, scent.seconds));\r\n        fillbars.bars.top -= 1;\r\n        const ls = gameState.lobbyState;\r\n        if (ls) {\r\n            ls.ownPeerData.nodesTouched && ls.ownPeerData.nodesTouched.push(node);\r\n        }\r\n    };\r\n    const onDrag = (node: number) => {\r\n        onStart();\r\n\r\n        if (lastDelta && isDropping && fillbars.bars.top > 0) {\r\n            dropOwn(node);\r\n            fillbars.bars.top <= 0 && (isDropping = false);\r\n        }\r\n    };\r\n    const onTap = (node: number) => {\r\n        if (lastDelta && fillbars.bars.top / fillbars.bars.max >= minTap) {\r\n            dropOwn(node);\r\n        }\r\n    };\r\n    const onStart = () => {\r\n        const fill = fillbars.bars.top / fillbars.bars.max;\r\n        lastDelta && fill >= minDrop && (isDropping = true);\r\n    };\r\n\r\n    const onEnd = () => {\r\n        isDropping = false;\r\n    };\r\n    addDropFunctionality(map.display, map.grid, onDrag, onTap, onStart, onEnd);\r\n    const update = (delta: number) => {\r\n        lastDelta = delta;\r\n        droppers.updates = droppers.updates.filter(update => update(delta));\r\n    };\r\n\r\n    const dropFromPeer = (nodes: number[]) => {\r\n        nodes.forEach(node => {\r\n            droppers.updates.push(makeScentDropper(scent, node, scent.seconds));\r\n            fillbars.bars.bottom -= 1;\r\n        });\r\n    };\r\n\r\n    return {update, droppers, dropFromPeer};\r\n};\r\n","export interface IPoint {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport const rotateToPoint = (m: IPoint, p: IPoint) => Math.atan2(m.y - p.y, m.x - p.x);\r\n\r\nexport const randomlyPositionInCircle = (maxDistanceSq: number, minDistanceSq: number, p: IPoint) => {\r\n    const ptAngle = Math.random() * 2 * Math.PI;\r\n    const ptRadiusSq = minDistanceSq + Math.random() * maxDistanceSq;\r\n    p.x += Math.sqrt(ptRadiusSq) * Math.cos(ptAngle);\r\n    p.y += Math.sqrt(ptRadiusSq) * Math.sin(ptAngle);\r\n};\r\n\r\nexport const clamp = (a: IPoint, limit: number) => {\r\n    if (magnitude(a) > limit) {\r\n        const n = normalize(a);\r\n        return multiplyScalar(n, limit);\r\n    }\r\n    return a;\r\n};\r\n\r\nexport const distanceSq = (b: IPoint, a: IPoint) => {\r\n    const dx = b.x - a.x;\r\n    const dy = b.y - a.y;\r\n\r\n    return dx * dx + dy * dy;\r\n};\r\n\r\nexport const areEqual = (a: IPoint, b: IPoint) => {\r\n    return Math.round(a.x) === Math.round(b.x) && Math.round(a.y) === Math.round(b.y);\r\n};\r\n\r\nexport const magnitude = (a: IPoint) => {\r\n    return Math.sqrt(a.x * a.x + a.y * a.y);\r\n};\r\n\r\nexport const normalize = (a: IPoint) => {\r\n    const m = magnitude(a);\r\n    if (m > 0) {\r\n        return multiplyScalar(a, 1 / m);\r\n    }\r\n    return a;\r\n};\r\n\r\nexport const multiplyScalar = (v: IPoint, scalar: number) => {\r\n    v.x *= scalar;\r\n    v.y *= scalar;\r\n    return v;\r\n};\r\n\r\nexport const divideByScalar = (v: IPoint, scalar: number) => {\r\n    v.x /= scalar;\r\n    v.y /= scalar;\r\n    return v;\r\n};\r\n\r\nexport const sqrt = (v: IPoint) => {\r\n    v.x = Math.sqrt(v.x);\r\n    v.y = Math.sqrt(v.y);\r\n    return v;\r\n};\r\n\r\nexport const addVector = (a: IPoint, b: IPoint) => {\r\n    a.x += b.x;\r\n    a.y += b.y;\r\n    return a;\r\n};\r\n\r\nexport const subtractVector = (a: IPoint, b: IPoint) => {\r\n    a.x -= b.x;\r\n    a.y -= b.y;\r\n    return a;\r\n};\r\n\r\nexport const rotateVector = (vec: IPoint, ang: number) => {\r\n    const cos = Math.cos(ang);\r\n    const sin = Math.sin(ang);\r\n    vec.x = vec.x * cos - vec.y * sin;\r\n    vec.y = vec.x * sin + vec.y * cos;\r\n    return vec;\r\n};\r\n","export function makeBoid(template?: any) {\r\n    return {\r\n        ...{\r\n            position: {x: 0, y: 0},\r\n            velocity: {x: 0, y: 0},\r\n            drag: 0.1,\r\n            speed: 1,\r\n            thrust: 10,\r\n            radius: 1\r\n        },\r\n        ...template\r\n    };\r\n}\r\n","import {\r\n    addVector,\r\n    subtractVector,\r\n    normalize,\r\n    multiplyScalar,\r\n    clamp,\r\n    divideByScalar,\r\n    distanceSq,\r\n    magnitude,\r\n    IPoint\r\n} from \"../../utils/geom\";\r\nimport {IBoid} from \"../makeBoids\";\r\nexport function separation(boid: IBoid, neighbors: IPoint[]) {\r\n    const steer = {x: 0, y: 0};\r\n    const numNeighbors = neighbors.length;\r\n    if (!numNeighbors) return {x: 0, y: 0};\r\n    for (let neighbor of neighbors) {\r\n        const d = distanceSq(boid.position, neighbor) || Math.random();\r\n        const diff = subtractVector({...boid.position}, neighbor);\r\n        normalize(diff);\r\n        divideByScalar(diff, d);\r\n        addVector(steer, diff);\r\n    }\r\n    divideByScalar(steer, numNeighbors);\r\n    const steerForce = magnitude(steer);\r\n    if (steerForce > 0) {\r\n        normalize(steer);\r\n        multiplyScalar(steer, boid.speed);\r\n        subtractVector(steer, boid.velocity);\r\n        clamp(steer, boid.thrust);\r\n    }\r\n    return steer;\r\n}\r\n","import {addVector, divideByScalar, IPoint} from \"../../utils/geom\";\r\nimport {seek} from \"../steering/seek\";\r\nimport {IBoid} from \"../makeBoids\";\r\n\r\nexport function cohesion(boid: IBoid, neighbors: IPoint[]) {\r\n    const steer = {x: 0, y: 0};\r\n    const numNeighbors = neighbors.length;\r\n    if (!numNeighbors) return {x: 0, y: 0};\r\n    for (let neighbor of neighbors) {\r\n        addVector(steer, neighbor);\r\n    }\r\n    return seek(divideByScalar(steer, numNeighbors), boid);\r\n}\r\n","import {subtractVector, normalize, multiplyScalar, clamp, IPoint} from \"../../utils/geom\";\r\nimport {IBoid} from \"../makeBoids\";\r\nexport function seek(target: IPoint, boid: IBoid) {\r\n    const d = subtractVector({...target}, boid.position);\r\n    normalize(d);\r\n    multiplyScalar(d, boid.speed);\r\n    subtractVector(d, boid.velocity);\r\n    clamp(d, boid.thrust);\r\n    return d;\r\n}\r\n","import {addVector, IPoint} from \"../../utils/geom\";\r\nexport function applyForce(vector: IPoint, force: IPoint) {\r\n    addVector(vector, force);\r\n}\r\n","import {IPoint, multiplyScalar, addVector, clamp, normalize} from \"../utils/geom\";\r\nimport {IGridBoid} from \"./IGridBoid\";\r\nimport {IBoidTemplate} from \"./IBoidTemplate\";\r\nimport Grid from \"../scentmap/hexgrid/Grid\";\r\nimport {IDisplay} from \"../pixi/types\";\r\nimport {IScent} from \"../scentmap/scent/types\";\r\nimport {makeBoids} from \"./makeBoids\";\r\nimport {makeBoidsViews} from \"../pixi/boids/makeBoidsViews\";\r\nimport {makeBoid} from \"./makeBoid\";\r\nimport {separation} from \"./behavior/separation\";\r\nimport {cohesion} from \"./behavior/cohesion\";\r\nimport {getSteering} from \"./getSteering\";\r\n\r\nconst MAX_NEIGHBORS = 12;\r\nconst INITIAL_BOIDS = 0;\r\nconst MAX_BOIDS = 200;\r\n\r\nexport class GridBoids {\r\n    public boids!: IGridBoid[];\r\n    public boidViews!: PIXI.Sprite[];\r\n    private occupiableNodes!: Array<Set<IGridBoid>>;\r\n    private numNodes!: number;\r\n\r\n    constructor(\r\n        public boidTemplate: IBoidTemplate,\r\n        public grid: Grid,\r\n        public display: IDisplay,\r\n        public walls: number[],\r\n        public scentToAvoid: IScent\r\n    ) {\r\n        this.initialize();\r\n    }\r\n\r\n    private initialize() {\r\n        this.boids = (makeBoids(INITIAL_BOIDS, this.boidTemplate) as any) as IGridBoid[];\r\n        const boidViewsObj = makeBoidsViews(this.display.hexTexture, MAX_BOIDS);\r\n        this.display.camera.addChild(boidViewsObj.view);\r\n        this.boidViews = boidViewsObj.sprites;\r\n        this.occupiableNodes = Array.from(this.grid.gridArr, node => new Set<IGridBoid>());\r\n        this.numNodes = this.grid.gridArr.length;\r\n    }\r\n\r\n    public reset() {\r\n        if (this.boidViews && this.boidViews.length) {\r\n            const view = this.boidViews[0].parent;\r\n            if (view.parent) {\r\n                view.parent.removeChild(view);\r\n            }\r\n        }\r\n        this.initialize();\r\n    }\r\n\r\n    public update(delta?: number) {\r\n        this.updateBoids(delta);\r\n        this.updateViews(delta);\r\n    }\r\n\r\n    public addBoid(position: IPoint) {\r\n        const b = makeBoid(this.boidTemplate) as IGridBoid;\r\n        this.boids.push(b);\r\n        b.position = {...position};\r\n        b.node = this.grid.getHexIdByPixel(b.position);\r\n        return b;\r\n    }\r\n\r\n    public addBoidAtNode(nodeId: number) {\r\n        const b = makeBoid(this.boidTemplate) as IGridBoid;\r\n        this.boids.push(b);\r\n        b.node = nodeId;\r\n        b.position = this.grid.getPosAtNode(nodeId);\r\n        return b;\r\n    }\r\n\r\n    public removeBoid(boid?: IGridBoid) {\r\n        if (boid) {\r\n            this.boids.splice(this.boids.indexOf(boid), 1);\r\n            return;\r\n        }\r\n        this.boids.pop();\r\n    }\r\n\r\n    private updateViews(delta?: number) {\r\n        const l = this.boids.length;\r\n        this.boidViews.forEach((sprite, i) => {\r\n            sprite.alpha = i < l ? 1 : 0;\r\n            if (sprite.alpha) {\r\n                const boid = this.boids[i];\r\n                sprite.tint = this.boidTemplate.hue;\r\n                sprite.position.set(boid.position.x, boid.position.y);\r\n                sprite.scale.x !== boid.radius && sprite.scale.set(boid.radius, boid.radius);\r\n            }\r\n        });\r\n    }\r\n\r\n    private updateBoids(delta?: number) {\r\n        this.boids.forEach(boid => {\r\n            if (boid.node < 0 || boid.node >= this.numNodes) return;\r\n            const node = this.grid.getHexIdByPixel(boid.position);\r\n            if (isNaN(node)) return;\r\n            const oNodes = this.occupiableNodes;\r\n            boid.node && oNodes[boid.node].delete(boid);\r\n            boid.node = node;\r\n            const neighborNodes = this.grid.gridArr[boid.node].neighbors.filter(n => !isNaN(n));\r\n            let neighbors: IGridBoid[] = [];\r\n            const obstacles = new Array<IPoint>();\r\n            neighborNodes.forEach(n => {\r\n                const ns = Array.from(oNodes[n]);\r\n                ns.length && neighbors.length < MAX_NEIGHBORS && (neighbors = neighbors.concat(ns));\r\n                !this.walls[n] && obstacles.push(this.grid.gridArr[n].position);\r\n            });\r\n\r\n            let highestScent: number = 0;\r\n            let avoidGoal: IPoint | null = null;\r\n\r\n            for (let neighbor of neighborNodes) {\r\n                const avoidVal = this.scentToAvoid.scentGrid[neighbor];\r\n                if (avoidVal > highestScent && avoidVal > boid.olfaction) {\r\n                    highestScent = avoidVal;\r\n                    avoidGoal = {...this.grid.gridArr[neighbor].position};\r\n                }\r\n            }\r\n            const avoidGoals = avoidGoal ? [avoidGoal] : [];\r\n            const forces = [\r\n                multiplyScalar(separation(boid, obstacles), this.boidTemplate.weights.avoidObstacles * 100),\r\n                multiplyScalar(separation(boid, neighbors.map(n => n.position)), this.boidTemplate.weights.separation),\r\n                multiplyScalar(separation(boid, avoidGoals), this.boidTemplate.weights.avoidScent),\r\n                multiplyScalar(cohesion(boid, neighbors.map(n => n.position)), this.boidTemplate.weights.cohesion)\r\n                // multiplyScalar(wander(boid, current), 1),\r\n                // multiplyScalar(alignment(boid, neighbors.map(n => n.velocity)), this.boidTemplate.weights.alignment)\r\n            ];\r\n            const steer = getSteering(boid, forces);\r\n            applySteering(steer, boid, delta || 1);\r\n            oNodes[boid.node].add(boid);\r\n        });\r\n    }\r\n}\r\n\r\nconst applySteering = (steering: IPoint, boid: IGridBoid, delta: number) => {\r\n    normalize(steering);\r\n    multiplyScalar(steering, boid.thrust);\r\n    addVector(boid.velocity, steering);\r\n    clamp(boid.velocity, boid.speed);\r\n    const motion = multiplyScalar({...boid.velocity}, delta);\r\n    addVector(boid.position, motion);\r\n    multiplyScalar(boid.velocity, boid.drag);\r\n};\r\n","import {IPoint} from \"./../utils/geom\";\r\nimport {makeBoid} from \"./makeBoid\";\r\n\r\nexport interface IBoid {\r\n    position: IPoint;\r\n    velocity: IPoint;\r\n    drag: number;\r\n    speed: number;\r\n    thrust: number;\r\n    radius: number;\r\n}\r\n\r\nexport function makeBoids(numBoids: number, template?: any) {\r\n    return Array.from({length: numBoids}, n => makeBoid(template));\r\n}\r\n","import {addVector, multiplyScalar, clamp, IPoint, divideByScalar} from \"../utils/geom\";\r\nimport {applyForce} from \"./steering/applyForce\";\r\nimport {IBoid} from \"./makeBoids\";\r\n\r\nexport function getSteering(boid: IBoid, forces: IPoint[]) {\r\n    const steering = {x: 0, y: 0};\r\n    for (let force of forces) {\r\n        applyForce(steering, force);\r\n    }\r\n    divideByScalar(steering, forces.length);\r\n    return steering;\r\n}\r\n","export const boidTemplate = {\r\n    drag: 0.96,\r\n    speed: 150,\r\n    thrust: 10,\r\n    radius: 1,\r\n    olfaction: 0.001,\r\n    hue: 0xff80ff,\r\n    weights: {\r\n        separation: 6,\r\n        cohesion: 4,\r\n        seekScent: 6,\r\n        avoidScent: 8,\r\n        avoidObstacles: 10,\r\n        alignment: 5\r\n    }\r\n};\r\n","import {GridBoids} from \"boids/GridBoids\";\r\nimport {GridMap} from \"types\";\r\nimport {IScent} from \"scentmap/scent/types\";\r\nimport {boidTemplate} from \"./boidTemplate\";\r\n\r\nexport const populateBoids = (boids: GridBoids) => {\r\n    return Array.from({length: 11}, (n, i) => {\r\n        boids.addBoidAtNode(589 + i * 2);\r\n        boids.addBoidAtNode(640 + i * 2);\r\n        boids.addBoidAtNode(691 + i * 2);\r\n        return null;\r\n    });\r\n};\r\n\r\nexport const makeBoids = (map: GridMap, scent: IScent) => {\r\n    const boids = new GridBoids(boidTemplate, map.grid, map.display, map.walls, scent);\r\n    populateBoids(boids);\r\n    return boids;\r\n};\r\n","import Grid from \"./../../scentmap/hexgrid/Grid\";\r\nimport * as PIXI from \"pixi.js\";\r\n\r\nexport function makeHexesGrid(grid: Grid, tex: PIXI.Texture, tint: number = 0xddddda) {\r\n    const view = new PIXI.ParticleContainer(500000, {\r\n        tint: true\r\n    });\r\n    const nodes = grid.gridArr.map(node => {\r\n        const sprite = new PIXI.Sprite(tex);\r\n        sprite.position.set(node.position.x, node.position.y);\r\n        view.addChild(sprite);\r\n        sprite.tint = tint;\r\n        sprite.alpha = 0;\r\n        return sprite;\r\n    });\r\n\r\n    return {view, nodes};\r\n}\r\n","import {makeScent} from \"../../scentmap/scent/makeScent\";\r\nimport {makeHexesGrid} from \"../../pixi/hexgrid/makeHexesGrid\";\r\nimport {GridMap} from \"types\";\r\nimport {makeUpdateScent} from \"scentmap/scent/makeUpdateScent\";\r\nimport {makeUpdateHexColorsByScent} from \"pixi/scent/makeUpdateHexColorsByScent\";\r\nexport const makeAvoidScent = (map: GridMap) => {\r\n    const data = makeScent(map.grid);\r\n    const display = makeHexesGrid(map.grid, map.display.hexTexture, data.hue);\r\n    map.display.camera.addChild(display.view);\r\n    const updateScent = makeUpdateScent(map.grid, map.walls, data, data.scentGrid);\r\n    const updateScentView = makeUpdateHexColorsByScent(display.nodes, data);\r\n    const update = (delta: number) => {\r\n        updateScent(delta);\r\n        updateScentView(delta);\r\n    };\r\n    return {data: data, display: display, update};\r\n};\r\n","import {IScent} from \"./types\";\r\nimport {uuid} from \"../../utils/uuid\";\r\nimport Grid from \"../hexgrid/Grid\";\r\n\r\nexport function makeScent(\r\n    grid: Grid,\r\n    spread: number = 15,\r\n    evaporation: number = 0.9,\r\n    quantity: number = 10,\r\n    hue: number = 8454143,\r\n    minValue: number = 0.001,\r\n    seconds: number = 0\r\n): IScent {\r\n    const scentGrid: number[] = Array.from(grid.gridArr, n => 0);\r\n    const permeability: number[] = Array.from(grid.gridArr, n => 1);\r\n    return {\r\n        scentGrid,\r\n        permeability,\r\n        id: uuid(),\r\n        spread,\r\n        evaporation,\r\n        quantity,\r\n        hue,\r\n        minValue,\r\n        seconds\r\n    };\r\n}\r\n","import {IScent} from \"./types\";\r\nimport Grid from \"../hexgrid/Grid\";\r\n\r\nexport function makeUpdateScent(grid: Grid, walls: number[], scent: IScent, scentGrid: number[]) {\r\n    return (delta: number) => {\r\n        for (let node = 0; node < scentGrid.length; node++) {\r\n            const w = walls[node];\r\n            if (isNaN(w) || !w) {\r\n                scentGrid[node] = 0;\r\n                continue;\r\n            }\r\n            const targets = grid.gridArr[node].neighbors;\r\n            const scentVal = scentGrid[node];\r\n            if (isNaN(scentVal) || !scent) {\r\n                scentGrid[node] = 0;\r\n                continue;\r\n            }\r\n            const validTargets = targets.filter(id => !isNaN(walls[id]) && walls[id]);\r\n            const dSpread = Math.min(1, scent.spread * delta);\r\n            const distribute = scentVal * dSpread;\r\n            const dSlice = (distribute / validTargets.length) * scent.evaporation;\r\n            for (let id of validTargets) {\r\n                const v = dSlice * walls[id];\r\n                scentGrid[id] += v;\r\n            }\r\n            scentGrid[node] = scentGrid[node] - distribute;\r\n        }\r\n        scent.scentGrid.forEach((n, nodeId) => {\r\n            const s = scentGrid[nodeId];\r\n            scent.scentGrid[nodeId] = s >= scent.minValue ? s : 0;\r\n        });\r\n    };\r\n}\r\n","import {IScent} from \"../../scentmap/scent/types\";\r\n\r\nexport function makeUpdateHexColorsByScent(gridSprites: PIXI.Sprite[], scent: IScent) {\r\n    const average = (scent.quantity + scent.minValue) / 20;\r\n    return (delta: number) => {\r\n        gridSprites.forEach((s, i) => {\r\n            s.tint = scent.hue;\r\n            s.alpha = Math.min(0.75, Math.min(average, scent.scentGrid[i]) / average);\r\n        });\r\n    };\r\n}\r\n","// adapted from http://www.redblobgames.com/grids/hexagons/\r\n\r\n/* Specifically for offset grid diagrams */\r\nexport function makeRectangularShape(\r\n    minCol: number,\r\n    maxCol: number,\r\n    minRow: number,\r\n    maxRow: number,\r\n    convert: (coord: OffsetCoord) => Hex\r\n) {\r\n    const results = [];\r\n    for (let col = minCol; col <= maxCol; col++) {\r\n        for (let row = minRow; row <= maxRow; row++) {\r\n            const hex = convert(new OffsetCoord(col, row));\r\n            results.push(hex);\r\n        }\r\n    }\r\n    return results;\r\n}\r\n\r\n/* Specifically for doubled grid diagrams */\r\nexport function makeRDoubledRectangularShape(minCol: number, maxCol: number, minRow: number, maxRow: number) {\r\n    const results = [];\r\n    for (let row = minRow; row <= maxRow; row++) {\r\n        for (let col = minCol + (row & 1); col <= maxCol; col += 2) {\r\n            const hex = new DoubledCoord(col, row).rdoubledToCube();\r\n            results.push(hex);\r\n        }\r\n    }\r\n    return results;\r\n}\r\n\r\nexport function makeLine(A: Hex, B: Hex) {\r\n    /* see https://www.redblobgames.com/grids/line-drawing.html */\r\n\r\n    /* HACK: add a tiny offset to the start point to break ties,\r\n     * because there are a lot of ties on a grid, and I want it to\r\n     * always round the same direction for consistency. To demonstrate\r\n     * the need for this hack, draw a line from Hex(-5, 0, +5) to\r\n     * Hex(+5, -5, 0). Without the hack, there are points on the edge\r\n     * that will sometimes be rounded one way and sometimes the other.\r\n     * The hack will force them to be rounded consistently. */\r\n    const offset = new Hex(1e-6, 2e-6, -3e-6);\r\n\r\n    const N = A.subtract(B).len();\r\n    const results = [];\r\n    for (let i = 0; i <= N; i++) {\r\n        results.push(\r\n            A.lerp(B, i / Math.max(1, N))\r\n                .add(offset)\r\n                .round()\r\n        );\r\n    }\r\n    return results;\r\n}\r\n\r\nexport class Point {\r\n    constructor(public x: number, public y: number) {}\r\n}\r\n\r\nexport class Hex {\r\n    public static directions: Hex[] = [\r\n        new Hex(1, 0, -1),\r\n        new Hex(1, -1, 0),\r\n        new Hex(0, -1, 1),\r\n        new Hex(-1, 0, 1),\r\n        new Hex(-1, 1, 0),\r\n        new Hex(0, 1, -1)\r\n    ];\r\n\r\n    public static diagonals: Hex[] = [\r\n        new Hex(2, -1, -1),\r\n        new Hex(1, -2, 1),\r\n        new Hex(-1, -1, 2),\r\n        new Hex(-2, 1, 1),\r\n        new Hex(-1, 2, -1),\r\n        new Hex(1, 1, -2)\r\n    ];\r\n\r\n    public static direction(direction: number): Hex {\r\n        return Hex.directions[direction];\r\n    }\r\n\r\n    private n8s!: Hex[];\r\n    private roundHex!: Hex;\r\n\r\n    constructor(public q: number, public r: number, public s: number) {\r\n        if (Math.round(q + r + s) !== 0) throw new Error(\"q + r + s must be 0\");\r\n    }\r\n\r\n    get id() {\r\n        return `${this.q} ${this.r} ${this.s}`;\r\n    }\r\n\r\n    public add(b: Hex): Hex {\r\n        return new Hex(this.q + b.q, this.r + b.r, this.s + b.s);\r\n    }\r\n\r\n    public subtract(b: Hex): Hex {\r\n        return new Hex(this.q - b.q, this.r - b.r, this.s - b.s);\r\n    }\r\n\r\n    public scale(k: number): Hex {\r\n        return new Hex(this.q * k, this.r * k, this.s * k);\r\n    }\r\n\r\n    public rotateLeft(): Hex {\r\n        return new Hex(-this.s, -this.q, -this.r);\r\n    }\r\n\r\n    public rotateRight(): Hex {\r\n        return new Hex(-this.r, -this.s, -this.q);\r\n    }\r\n\r\n    public neighbors(): Hex[] {\r\n        if (this.n8s) return this.n8s;\r\n        this.n8s = Hex.directions.map(direction => this.add(direction));\r\n        return this.n8s;\r\n    }\r\n\r\n    public neighbor(direction: number): Hex {\r\n        return this.neighbors()[direction];\r\n    }\r\n\r\n    public diagonalNeighbor(direction: number): Hex {\r\n        return this.add(Hex.diagonals[direction]);\r\n    }\r\n\r\n    public len(): number {\r\n        return (Math.abs(this.q) + Math.abs(this.r) + Math.abs(this.s)) / 2;\r\n    }\r\n\r\n    public distance(b: Hex): number {\r\n        return this.subtract(b).len();\r\n    }\r\n\r\n    public round(): Hex {\r\n        if (this.roundHex) return this.roundHex;\r\n        let qi: number = Math.round(this.q);\r\n        let ri: number = Math.round(this.r);\r\n        let si: number = Math.round(this.s);\r\n        const qDiff: number = Math.abs(qi - this.q);\r\n        const rDiff: number = Math.abs(ri - this.r);\r\n        const sDiff: number = Math.abs(si - this.s);\r\n        if (qDiff > rDiff && qDiff > sDiff) {\r\n            qi = -ri - si;\r\n        } else if (rDiff > sDiff) {\r\n            ri = -qi - si;\r\n        } else {\r\n            si = -qi - ri;\r\n        }\r\n        this.roundHex = new Hex(qi, ri, si);\r\n        return this.roundHex;\r\n    }\r\n\r\n    public lerp(b: Hex, t: number): Hex {\r\n        return new Hex(this.q * (1 - t) + b.q * t, this.r * (1 - t) + b.r * t, this.s * (1 - t) + b.s * t);\r\n    }\r\n\r\n    public linedraw(b: Hex): Hex[] {\r\n        const N: number = this.distance(b);\r\n        const aNudge: Hex = new Hex(this.q + 0.000001, this.r + 0.000001, this.s - 0.000002);\r\n        const bNudge: Hex = new Hex(b.q + 0.000001, b.r + 0.000001, b.s - 0.000002);\r\n        const results: Hex[] = [];\r\n        const step: number = 1.0 / Math.max(N, 1);\r\n        for (let i = 0; i <= N; i++) {\r\n            results.push(aNudge.lerp(bNudge, step * i).round());\r\n        }\r\n        return results;\r\n    }\r\n}\r\n\r\nexport class OffsetCoord {\r\n    public static EVEN: number = 1;\r\n    public static ODD: number = -1;\r\n\r\n    public static qoffsetFromCube(offset: number, h: Hex): OffsetCoord {\r\n        const col: number = h.q;\r\n        const row: number = h.r + (h.q + offset * (h.q & 1)) / 2;\r\n        return new OffsetCoord(col, row);\r\n    }\r\n\r\n    public static qoffsetToCube(offset: number, h: OffsetCoord): Hex {\r\n        const q: number = h.col;\r\n        const r: number = h.row - (h.col + offset * (h.col & 1)) / 2;\r\n        const s: number = -q - r;\r\n        return new Hex(q, r, s);\r\n    }\r\n\r\n    public static roffsetFromCube(offset: number, h: Hex): OffsetCoord {\r\n        const col: number = h.q + (h.r + offset * (h.r & 1)) / 2;\r\n        const row: number = h.r;\r\n        return new OffsetCoord(col, row);\r\n    }\r\n\r\n    public static roffsetToCube(offset: number, h: OffsetCoord): Hex {\r\n        const q: number = h.col - (h.row + offset * (h.row & 1)) / 2;\r\n        const r: number = h.row;\r\n        const s: number = -q - r;\r\n        return new Hex(q, r, s);\r\n    }\r\n    constructor(public col: number, public row: number) {}\r\n}\r\n\r\nexport class DoubledCoord {\r\n    public static qdoubledFromCube(h: Hex): DoubledCoord {\r\n        const col: number = h.q;\r\n        const row: number = 2 * h.r + h.q;\r\n        return new DoubledCoord(col, row);\r\n    }\r\n\r\n    public static rdoubledFromCube(h: Hex): DoubledCoord {\r\n        const col: number = 2 * h.q + h.r;\r\n        const row: number = h.r;\r\n        return new DoubledCoord(col, row);\r\n    }\r\n\r\n    constructor(public col: number, public row: number) {}\r\n\r\n    public qdoubledToCube(): Hex {\r\n        const q: number = this.col;\r\n        const r: number = (this.row - this.col) / 2;\r\n        const s: number = -q - r;\r\n        return new Hex(q, r, s);\r\n    }\r\n\r\n    public rdoubledToCube(): Hex {\r\n        const q: number = (this.col - this.row) / 2;\r\n        const r: number = this.row;\r\n        const s: number = -q - r;\r\n        return new Hex(q, r, s);\r\n    }\r\n}\r\n\r\nexport class Orientation {\r\n    constructor(\r\n        public f0: number,\r\n        public f1: number,\r\n        public f2: number,\r\n        public f3: number,\r\n        public b0: number,\r\n        public b1: number,\r\n        public b2: number,\r\n        public b3: number,\r\n        public startAngle: number\r\n    ) {}\r\n}\r\n\r\nexport class Layout {\r\n    public static pointy: Orientation = new Orientation(\r\n        Math.sqrt(3.0),\r\n        Math.sqrt(3.0) / 2.0,\r\n        0.0,\r\n        3.0 / 2.0,\r\n        Math.sqrt(3.0) / 3.0,\r\n        -1.0 / 3.0,\r\n        0.0,\r\n        2.0 / 3.0,\r\n        0.5\r\n    );\r\n    public static flat: Orientation = new Orientation(\r\n        3.0 / 2.0,\r\n        0.0,\r\n        Math.sqrt(3.0) / 2.0,\r\n        Math.sqrt(3.0),\r\n        2.0 / 3.0,\r\n        0.0,\r\n        -1.0 / 3.0,\r\n        Math.sqrt(3.0) / 3.0,\r\n        0.0\r\n    );\r\n    constructor(public orientation: Orientation, public size: Point, public origin: Point) {}\r\n\r\n    public hexToPixel(h: Hex): Point {\r\n        const M: Orientation = this.orientation;\r\n        const size: Point = this.size;\r\n        const origin: Point = this.origin;\r\n        const x: number = (M.f0 * h.q + M.f1 * h.r) * size.x;\r\n        const y: number = (M.f2 * h.q + M.f3 * h.r) * size.y;\r\n        return new Point(x + origin.x, y + origin.y);\r\n    }\r\n\r\n    public pixelToHex(p: Point): Hex {\r\n        const M: Orientation = this.orientation;\r\n        const size: Point = this.size;\r\n        const origin: Point = this.origin;\r\n        const pt: Point = new Point((p.x - origin.x) / size.x, (p.y - origin.y) / size.y);\r\n        const q: number = M.b0 * pt.x + M.b1 * pt.y;\r\n        const r: number = M.b2 * pt.x + M.b3 * pt.y;\r\n        return new Hex(q, r, -q - r);\r\n    }\r\n\r\n    public hexCornerOffset(corner: number): Point {\r\n        const M: Orientation = this.orientation;\r\n        const size: Point = this.size;\r\n        const angle: number = (2.0 * Math.PI * (M.startAngle - corner)) / 6;\r\n        return new Point(size.x * Math.cos(angle), size.y * Math.sin(angle));\r\n    }\r\n\r\n    public polygonCorners(h: Hex): Point[] {\r\n        const corners: Point[] = [];\r\n        const center: Point = this.hexToPixel(h);\r\n        for (let i = 0; i < 6; i++) {\r\n            const offset: Point = this.hexCornerOffset(i);\r\n            corners.push(new Point(center.x + offset.x, center.y + offset.y));\r\n        }\r\n        return corners;\r\n    }\r\n}\r\n","import {IGridNode, IGridParams} from \"./types\";\r\nimport * as hexagons from \"./hexagons\";\r\nimport {IPoint} from \"./../../utils/geom\";\r\n\r\nconst makeNeighbors2 = (h: hexagons.Hex): hexagons.Hex[] => {\r\n    const n2: hexagons.Hex[] = Array.from(\r\n        new Set<hexagons.Hex>(([] as hexagons.Hex[]).concat.apply([], h.neighbors().map(hh => hh.neighbors())))\r\n    );\r\n    return n2;\r\n};\r\n\r\nexport default class Grid {\r\n    public gridArr: IGridNode[];\r\n    public edges: number[];\r\n    public gridHash: {[key: string]: number};\r\n    private _layout: hexagons.Layout;\r\n    private _hexes: hexagons.Hex[];\r\n\r\n    constructor(public gridLayout: IGridParams) {\r\n        this._hexes = hexagons.makeRDoubledRectangularShape(0, gridLayout.columns, 0, gridLayout.rows);\r\n        console.log(`gid with ${this._hexes.length} hexes`);\r\n        const hIds = this._hexes.reduce(\r\n            (acc: {[key: string]: number}, cur: hexagons.Hex, i: number) => {\r\n                acc[cur.id] = i;\r\n                return acc;\r\n            },\r\n            {} as {[key: string]: number}\r\n        );\r\n        this._layout = new hexagons.Layout(\r\n            hexagons.Layout.pointy,\r\n            {x: gridLayout.hexSize, y: gridLayout.hexSize},\r\n            {x: 0, y: 0}\r\n        );\r\n        this.gridHash = {};\r\n        this.gridArr = this._hexes.map((h, i) => {\r\n            const entry: IGridNode = {\r\n                id: h.id,\r\n                neighbors: h.neighbors().map(n => hIds[n.id]),\r\n                neighbors2: makeNeighbors2(h)\r\n                    .map(n => hIds[n.id])\r\n                    .filter(id => String(id) !== String(h.id)),\r\n                position: this._layout.hexToPixel(h)\r\n            };\r\n            this.gridHash[entry.id] = i;\r\n            return entry;\r\n        });\r\n        this.edges = this.gridArr.reduce((acc, cur, i) => {\r\n            if (cur.neighbors.findIndex(v => typeof v === \"undefined\") !== -1) acc.push(i);\r\n            return acc;\r\n        }, new Array<number>());\r\n    }\r\n\r\n    public getHexShape(): IPoint[] {\r\n        return this._layout.polygonCorners(this._hexes[0]);\r\n    }\r\n\r\n    public getHexPosAtPixel(world: IPoint): IPoint {\r\n        return this._layout.hexToPixel(this._layout.pixelToHex(world));\r\n    }\r\n\r\n    public getPosAtNode(nodeId: number): IPoint {\r\n        const node = this.gridArr[nodeId];\r\n        if (!node) throw new Error(`Node ${nodeId} not found`);\r\n        return {...node.position};\r\n    }\r\n\r\n    public getHexIdByPixel(position: IPoint): number {\r\n        const hex = this._layout.pixelToHex(position).round();\r\n        return this.gridHash[hex.id];\r\n    }\r\n}\r\n","import makeCamera from \"../makeCamera\";\r\nimport Grid from \"../../scentmap/hexgrid/Grid\";\r\n\r\nexport default function makeGridCamera(pixi: PIXI.Application, grid: Grid, hexSize: number) {\r\n    const lastNode = grid.gridArr[grid.gridArr.length - 1];\r\n    const height = lastNode.position.y + hexSize * 2;\r\n    const width = lastNode.position.x + hexSize * 2;\r\n\r\n    const cam = makeCamera(pixi, width, height)\r\n        // .wheel()\r\n        .drag()\r\n        // .pinch()\r\n        // .decelerate()\r\n        .clamp({direction: \"all\", underflow: \"center\"})\r\n        .clampZoom({minWidth: width, minHeight: height});\r\n    // .bounce()\r\n    cam.position.set(width / 2, height / 2);\r\n    return cam;\r\n}\r\n","import {Viewport} from \"pixi-viewport\";\r\n\r\nexport default function makeCamera(pixi: PIXI.Application, worldWidth: number, worldHeight: number) {\r\n    const viewport = new Viewport({\r\n        screenWidth: window.innerWidth,\r\n        screenHeight: window.innerHeight,\r\n        worldWidth,\r\n        worldHeight\r\n    });\r\n    pixi.stage.addChild(viewport);\r\n    return viewport;\r\n}\r\n","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *===========================================================\r\n * reworked by Alex Tavor to work nicely with TS and ES6\r\n */\r\n\r\nclass Grad {\r\n    constructor(public x: number, public y: number, public z: number) {}\r\n    public dot2(x: number, y: number) {\r\n        return this.x * x + this.y * y;\r\n    }\r\n    public dot3(x: number, y: number, z: number) {\r\n        return this.x * x + this.y * y + this.z * z;\r\n    }\r\n}\r\n\r\nconst grad3 = [\r\n    new Grad(1, 1, 0),\r\n    new Grad(-1, 1, 0),\r\n    new Grad(1, -1, 0),\r\n    new Grad(-1, -1, 0),\r\n    new Grad(1, 0, 1),\r\n    new Grad(-1, 0, 1),\r\n    new Grad(1, 0, -1),\r\n    new Grad(-1, 0, -1),\r\n    new Grad(0, 1, 1),\r\n    new Grad(0, -1, 1),\r\n    new Grad(0, 1, -1),\r\n    new Grad(0, -1, -1)\r\n];\r\n\r\nconst p = [\r\n    151,\r\n    160,\r\n    137,\r\n    91,\r\n    90,\r\n    15,\r\n    131,\r\n    13,\r\n    201,\r\n    95,\r\n    96,\r\n    53,\r\n    194,\r\n    233,\r\n    7,\r\n    225,\r\n    140,\r\n    36,\r\n    103,\r\n    30,\r\n    69,\r\n    142,\r\n    8,\r\n    99,\r\n    37,\r\n    240,\r\n    21,\r\n    10,\r\n    23,\r\n    190,\r\n    6,\r\n    148,\r\n    247,\r\n    120,\r\n    234,\r\n    75,\r\n    0,\r\n    26,\r\n    197,\r\n    62,\r\n    94,\r\n    252,\r\n    219,\r\n    203,\r\n    117,\r\n    35,\r\n    11,\r\n    32,\r\n    57,\r\n    177,\r\n    33,\r\n    88,\r\n    237,\r\n    149,\r\n    56,\r\n    87,\r\n    174,\r\n    20,\r\n    125,\r\n    136,\r\n    171,\r\n    168,\r\n    68,\r\n    175,\r\n    74,\r\n    165,\r\n    71,\r\n    134,\r\n    139,\r\n    48,\r\n    27,\r\n    166,\r\n    77,\r\n    146,\r\n    158,\r\n    231,\r\n    83,\r\n    111,\r\n    229,\r\n    122,\r\n    60,\r\n    211,\r\n    133,\r\n    230,\r\n    220,\r\n    105,\r\n    92,\r\n    41,\r\n    55,\r\n    46,\r\n    245,\r\n    40,\r\n    244,\r\n    102,\r\n    143,\r\n    54,\r\n    65,\r\n    25,\r\n    63,\r\n    161,\r\n    1,\r\n    216,\r\n    80,\r\n    73,\r\n    209,\r\n    76,\r\n    132,\r\n    187,\r\n    208,\r\n    89,\r\n    18,\r\n    169,\r\n    200,\r\n    196,\r\n    135,\r\n    130,\r\n    116,\r\n    188,\r\n    159,\r\n    86,\r\n    164,\r\n    100,\r\n    109,\r\n    198,\r\n    173,\r\n    186,\r\n    3,\r\n    64,\r\n    52,\r\n    217,\r\n    226,\r\n    250,\r\n    124,\r\n    123,\r\n    5,\r\n    202,\r\n    38,\r\n    147,\r\n    118,\r\n    126,\r\n    255,\r\n    82,\r\n    85,\r\n    212,\r\n    207,\r\n    206,\r\n    59,\r\n    227,\r\n    47,\r\n    16,\r\n    58,\r\n    17,\r\n    182,\r\n    189,\r\n    28,\r\n    42,\r\n    223,\r\n    183,\r\n    170,\r\n    213,\r\n    119,\r\n    248,\r\n    152,\r\n    2,\r\n    44,\r\n    154,\r\n    163,\r\n    70,\r\n    221,\r\n    153,\r\n    101,\r\n    155,\r\n    167,\r\n    43,\r\n    172,\r\n    9,\r\n    129,\r\n    22,\r\n    39,\r\n    253,\r\n    19,\r\n    98,\r\n    108,\r\n    110,\r\n    79,\r\n    113,\r\n    224,\r\n    232,\r\n    178,\r\n    185,\r\n    112,\r\n    104,\r\n    218,\r\n    246,\r\n    97,\r\n    228,\r\n    251,\r\n    34,\r\n    242,\r\n    193,\r\n    238,\r\n    210,\r\n    144,\r\n    12,\r\n    191,\r\n    179,\r\n    162,\r\n    241,\r\n    81,\r\n    51,\r\n    145,\r\n    235,\r\n    249,\r\n    14,\r\n    239,\r\n    107,\r\n    49,\r\n    192,\r\n    214,\r\n    31,\r\n    181,\r\n    199,\r\n    106,\r\n    157,\r\n    184,\r\n    84,\r\n    204,\r\n    176,\r\n    115,\r\n    121,\r\n    50,\r\n    45,\r\n    127,\r\n    4,\r\n    150,\r\n    254,\r\n    138,\r\n    236,\r\n    205,\r\n    93,\r\n    222,\r\n    114,\r\n    67,\r\n    29,\r\n    24,\r\n    72,\r\n    243,\r\n    141,\r\n    128,\r\n    195,\r\n    78,\r\n    66,\r\n    215,\r\n    61,\r\n    156,\r\n    180\r\n];\r\n// To remove the need for index wrapping, double the permutation table length\r\nconst perm = new Array(512);\r\nconst gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nexport const seed = (s: number = 0) => {\r\n    if (s > 0 && s < 1) {\r\n        // Scale the seed out\r\n        s *= 65536;\r\n    }\r\n\r\n    s = Math.floor(s);\r\n    if (s < 256) {\r\n        s |= s << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (s & 255);\r\n        } else {\r\n            v = p[i] ^ ((s >> 8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\r\nconst G2 = (3 - Math.sqrt(3)) / 6;\r\n\r\nconst F3 = 1 / 3;\r\nconst G3 = 1 / 6;\r\n\r\n// 2D simplex noise\r\nexport const simplex2 = (xin: number, yin: number) => {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin + yin) * F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin + s);\r\n    let j = Math.floor(yin + s);\r\n    const t = (i + j) * G2;\r\n    const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin - j + t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0 > y0) {\r\n        // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1 = 1;\r\n        j1 = 0;\r\n    } else {\r\n        // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1 = 0;\r\n        j1 = 1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    const gi0 = gradP[i + perm[j]];\r\n    const gi1 = gradP[i + i1 + perm[j + j1]];\r\n    const gi2 = gradP[i + 1 + perm[j + 1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\r\n    if (t0 < 0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\r\n    if (t1 < 0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\r\n    if (t2 < 0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n\r\n// 3D simplex noise\r\nexport const simplex3 = (xin: number, yin: number, zin: number) => {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin + yin + zin) * F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin + s);\r\n    let j = Math.floor(yin + s);\r\n    let k = Math.floor(zin + s);\r\n\r\n    const t = (i + j + k) * G3;\r\n    const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin - j + t;\r\n    const z0 = zin - k + t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0) {\r\n            i1 = 1;\r\n            j1 = 0;\r\n            k1 = 0;\r\n            i2 = 1;\r\n            j2 = 1;\r\n            k2 = 0;\r\n        } else if (x0 >= z0) {\r\n            i1 = 1;\r\n            j1 = 0;\r\n            k1 = 0;\r\n            i2 = 1;\r\n            j2 = 0;\r\n            k2 = 1;\r\n        } else {\r\n            i1 = 0;\r\n            j1 = 0;\r\n            k1 = 1;\r\n            i2 = 1;\r\n            j2 = 0;\r\n            k2 = 1;\r\n        }\r\n    } else {\r\n        if (y0 < z0) {\r\n            i1 = 0;\r\n            j1 = 0;\r\n            k1 = 1;\r\n            i2 = 0;\r\n            j2 = 1;\r\n            k2 = 1;\r\n        } else if (x0 < z0) {\r\n            i1 = 0;\r\n            j1 = 1;\r\n            k1 = 0;\r\n            i2 = 0;\r\n            j2 = 1;\r\n            k2 = 1;\r\n        } else {\r\n            i1 = 0;\r\n            j1 = 1;\r\n            k1 = 0;\r\n            i2 = 1;\r\n            j2 = 1;\r\n            k2 = 0;\r\n        }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    const x1 = x0 - i1 + G3; // Offsets for second corner\r\n    const y1 = y0 - j1 + G3;\r\n    const z1 = z0 - k1 + G3;\r\n\r\n    const x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    const y2 = y0 - j2 + 2 * G3;\r\n    const z2 = z0 - k2 + 2 * G3;\r\n\r\n    const x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    const y3 = y0 - 1 + 3 * G3;\r\n    const z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    const gi0 = gradP[i + perm[j + perm[k]]];\r\n    const gi1 = gradP[i + i1 + perm[j + j1 + perm[k + k1]]];\r\n    const gi2 = gradP[i + i2 + perm[j + j2 + perm[k + k2]]];\r\n    const gi3 = gradP[i + 1 + perm[j + 1 + perm[k + 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\r\n    if (t0 < 0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0); // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\r\n    if (t1 < 0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\r\n    if (t2 < 0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\r\n    if (t3 < 0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n};\r\n\r\nfunction fade(t: number) {\r\n    return t * t * t * (t * (t * 6 - 15) + 10);\r\n}\r\n\r\nfunction lerp(a: number, b: number, t: number) {\r\n    return (1 - t) * a + t * b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nexport const perlin2 = (x: number, y: number) => {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x),\r\n        Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X;\r\n    y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255;\r\n    Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    const n00 = gradP[X + perm[Y]].dot2(x, y);\r\n    const n01 = gradP[X + perm[Y + 1]].dot2(x, y - 1);\r\n    const n10 = gradP[X + 1 + perm[Y]].dot2(x - 1, y);\r\n    const n11 = gradP[X + 1 + perm[Y + 1]].dot2(x - 1, y - 1);\r\n\r\n    // Compute the fade curve value for x\r\n    const u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(lerp(n00, n10, u), lerp(n01, n11, u), fade(y));\r\n};\r\n\r\n// 3D Perlin Noise\r\nexport const perlin3 = (x: number, y: number, z: number) => {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x),\r\n        Y = Math.floor(y),\r\n        Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X;\r\n    y = y - Y;\r\n    z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255;\r\n    Y = Y & 255;\r\n    Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    const n000 = gradP[X + perm[Y + perm[Z]]].dot3(x, y, z);\r\n    const n001 = gradP[X + perm[Y + perm[Z + 1]]].dot3(x, y, z - 1);\r\n    const n010 = gradP[X + perm[Y + 1 + perm[Z]]].dot3(x, y - 1, z);\r\n    const n011 = gradP[X + perm[Y + 1 + perm[Z + 1]]].dot3(x, y - 1, z - 1);\r\n    const n100 = gradP[X + 1 + perm[Y + perm[Z]]].dot3(x - 1, y, z);\r\n    const n101 = gradP[X + 1 + perm[Y + perm[Z + 1]]].dot3(x - 1, y, z - 1);\r\n    const n110 = gradP[X + 1 + perm[Y + 1 + perm[Z]]].dot3(x - 1, y - 1, z);\r\n    const n111 = gradP[X + 1 + perm[Y + 1 + perm[Z + 1]]].dot3(x - 1, y - 1, z - 1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    const u = fade(x);\r\n    const v = fade(y);\r\n    const w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(lerp(n000, n100, u), lerp(n001, n101, u), w),\r\n        lerp(lerp(n010, n110, u), lerp(n011, n111, u), w),\r\n        v\r\n    );\r\n};\r\n","import {hslToRgb, rgbArrayToHex} from \"../../utils/colorConversions\";\r\nimport {Sprite} from \"pixi.js\";\r\nimport Grid from \"../../scentmap/hexgrid/Grid\";\r\nimport * as noise from \"../../utils/simplexNoise\";\r\n\r\nnoise.seed(Math.random());\r\nconst defaultSpeed = 1;\r\nlet step = 0;\r\nlet current = Date.now();\r\nexport default function repaintWithNoise(\r\n    grid: Grid,\r\n    sprites: Sprite[],\r\n    scale: number = 0,\r\n    speed: number = defaultSpeed\r\n) {\r\n    const noiseScale = !scale ? Math.sqrt(grid.gridArr.length) * 12 : scale;\r\n    sprites.forEach((sprite: Sprite, i: number) => {\r\n        const position = grid.gridArr[i].position;\r\n        const rgb2 = hslToRgb(noise.simplex3(position.x / noiseScale, position.y / noiseScale, step), 0.5, 0.5);\r\n        const tint = rgbArrayToHex(rgb2);\r\n        sprite.tint = tint;\r\n    });\r\n    const nc = Date.now();\r\n    step += speed / (nc - current);\r\n    current = nc;\r\n}\r\n","import Grid from \"../scentmap/hexgrid/Grid\";\r\nimport {IDisplay} from \"./types\";\r\nimport {makePixiApp} from \"./makePixiApp\";\r\nimport {makeHexTexture} from \"./hexgrid/makeHexTexture\";\r\nimport {makeHexesGrid} from \"./hexgrid/makeHexesGrid\";\r\nimport makeGridCamera from \"./hexgrid/makeGridCamera\";\r\nimport repaintWithNoise from \"./hexgrid/repaintWithNoise\";\r\nimport {animationLoop} from \"../utils/loop/animationLoop\";\r\nimport addPrettyHexesClick from \"./hexgrid/addPrettyHexesClick\";\r\nimport {makeWallsView} from \"./walls/makeWallsView\";\r\n\r\nexport enum BgType {\r\n    staticNoise,\r\n    animatedNoise,\r\n    prettyHexesClick,\r\n    none\r\n}\r\n\r\nexport default function makeDisplay(\r\n    gameCanvas: HTMLDivElement,\r\n    grid: Grid,\r\n    walls: number[],\r\n    bgType: BgType = BgType.none\r\n): IDisplay {\r\n    const hs = grid.gridLayout.hexSize;\r\n    const pixi = makePixiApp(window.innerWidth - hs * 0.5, window.innerHeight - hs * 0.5);\r\n    const tex = makeHexTexture(grid, pixi);\r\n    const hexes = makeHexesGrid(grid, tex);\r\n    const bgSprites = hexes.nodes;\r\n    const camera = makeGridCamera(pixi, grid, hs);\r\n    const repaint = () => repaintWithNoise(grid, bgSprites, grid.gridArr.length / 10, 0.01);\r\n    switch (bgType) {\r\n        case BgType.animatedNoise:\r\n            animationLoop(repaint);\r\n            break;\r\n        case BgType.prettyHexesClick:\r\n            addPrettyHexesClick(grid, camera, hexes.nodes);\r\n            break;\r\n        case BgType.staticNoise:\r\n            repaint();\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    camera.addChild(hexes.view);\r\n\r\n    const wallsView = makeWallsView(grid, walls, tex);\r\n    camera.addChild(wallsView.view);\r\n\r\n    gameCanvas.appendChild(pixi.view);\r\n\r\n    return {pixi, bgSprites, camera, hexTexture: tex, wallsSprites: wallsView.nodes};\r\n}\r\n","import {ClickEventData} from \"pixi-viewport\";\r\nimport Grid from \"../../scentmap/hexgrid/Grid\";\r\nimport {distanceSq} from \"../../utils/geom\";\r\nimport {Sprite} from \"pixi.js\";\r\nimport {hexToRgb, rgbToHsl, rgbArrayToHex, hslToRgb} from \"../../utils/colorConversions\";\r\n\r\nexport default function addPrettyHexesClick(grid: Grid, camera: any, hexes: Sprite[]) {\r\n    const getDistances = (hexPoint: {x: number; y: number}) => {\r\n        let maxDist = 0;\r\n        const distances = grid.gridArr.map(node => {\r\n            const dist = distanceSq(hexPoint, node.position);\r\n            dist >= maxDist && (maxDist = dist);\r\n            return dist;\r\n        });\r\n        return {maxDist, distances};\r\n    };\r\n    const processNodesForDistance = (dist: {maxDist: number; distances: number[]}) => (\r\n        node: PIXI.Sprite,\r\n        i: number\r\n    ) => {\r\n        const rgb = hexToRgb(node.tint);\r\n        const hsl = rgbToHsl(rgb.r, rgb.g, rgb.g);\r\n        const d = Math.sqrt(dist.distances[i] / dist.maxDist);\r\n        hsl[0] = d;\r\n        hsl[1] = hsl[2] = 0.5;\r\n        // @ts-ignore\r\n        const rgb2 = hslToRgb(...hsl);\r\n        const hex2 = rgbArrayToHex(rgb2);\r\n        node.tint = hex2;\r\n    };\r\n    const onViewClicked = (data: ClickEventData) => {\r\n        const hexPoint = grid.getHexPosAtPixel(data.world);\r\n        const processNode = processNodesForDistance(getDistances(hexPoint));\r\n        hexes.forEach(processNode);\r\n    };\r\n    camera.on(\"clicked\", onViewClicked);\r\n}\r\n","import * as PIXI from \"pixi.js\";\r\n\r\nexport function makePixiApp(width: number = window.innerWidth, height: number = window.innerHeight) {\r\n    const app = new PIXI.Application({\r\n        width,\r\n        height,\r\n        transparent: true\r\n    });\r\n    return app;\r\n}\r\n","import Grid from \"./../../scentmap/hexgrid/Grid\";\r\nimport * as PIXI from \"pixi.js\";\r\n\r\nexport function makeHexTexture(grid: Grid, app: PIXI.Application) {\r\n    const graphics = new PIXI.Graphics();\r\n    graphics.lineStyle(1, 0xffffff);\r\n    graphics.beginFill(0xffffff);\r\n    const corners = grid.getHexShape();\r\n    const pixiCorners = corners.map((c: any) => {\r\n        return new PIXI.Point(c.x, c.y);\r\n    });\r\n    const poly = new PIXI.Polygon(pixiCorners);\r\n    // poly.close();\r\n    graphics.drawPolygon(poly);\r\n    graphics.endFill();\r\n    return app.renderer.generateTexture(graphics, PIXI.SCALE_MODES.NEAREST, 1);\r\n}\r\n","import Grid from \"./../../scentmap/hexgrid/Grid\";\r\nimport * as PIXI from \"pixi.js\";\r\n\r\nexport function makeWallsView(grid: Grid, walls: number[], tex: PIXI.Texture) {\r\n    const view = new PIXI.ParticleContainer(500000, {\r\n        tint: true\r\n    });\r\n    const nodes = grid.gridArr.map((node, i) => {\r\n        const sprite = new PIXI.Sprite(tex);\r\n        sprite.position.set(node.position.x, node.position.y);\r\n        view.addChild(sprite);\r\n        sprite.tint = 0xffff80;\r\n        sprite.alpha = Math.abs(walls[i] - 1);\r\n        return sprite;\r\n    });\r\n    return {view, nodes};\r\n}\r\n","import Grid from \"../../scentmap/hexgrid/Grid\";\r\nimport {makeWalls} from \"../../scentmap/walls/makeWalls\";\r\nimport makeDisplay, {BgType} from \"../../pixi/makeDisplay\";\r\nimport {GridMap} from \"types\";\r\n\r\nconst rows = 50;\r\nconst columns = rows;\r\nconst hexSize = 10;\r\n\r\nexport const makeMap = (gameCanvas: HTMLDivElement) => {\r\n    const grid = new Grid({rows, columns, hexSize});\r\n    const walls = makeWalls(grid);\r\n    const display = makeDisplay(gameCanvas, grid, walls, BgType.none);\r\n    return {grid, walls, display} as GridMap;\r\n};\r\n","import Grid from \"../hexgrid/Grid\";\r\n\r\nexport function makeWalls(grid: Grid) {\r\n    const numNodes = grid.gridArr.length;\r\n    const walls: number[] = new Array(numNodes).fill(1);\r\n    walls.forEach((w, i) => {\r\n        grid.edges.indexOf(i) !== -1 && (walls[i] = 0);\r\n    });\r\n    return walls;\r\n}\r\n","const config = {min: 0, refillPerSecond: 20};\r\n\r\nexport function makeFillbars(bars: {max: number; top: number; bottom: number}) {\r\n    const updateBar = (bar: number, delta: number) => {\r\n        const result = bar + config.refillPerSecond * delta;\r\n        if (result >= bars.max) {\r\n            return bars.max;\r\n        }\r\n        return result;\r\n    };\r\n    const update = (delta: number) => {\r\n        bars.top = updateBar(bars.top, delta);\r\n        bars.bottom = updateBar(bars.bottom, delta);\r\n    };\r\n    return {bars, update};\r\n}\r\n","import timeVariableLoop from \"utils/loop/timeVariableLoop\";\r\nimport {makeCollectors} from \"game/makeCollectors\";\r\nimport {GameState} from \"components/types\";\r\nimport {makeScentDroppers} from \"./makeScentDroppers\";\r\nimport {makeBoids, populateBoids} from \"./makeBoids\";\r\nimport {makeAvoidScent} from \"./makeAvoidScent\";\r\nimport {makeMap} from \"./makeMap\";\r\nimport {makeFillbars} from \"game/makeFillbars\";\r\nimport {GridBoids} from \"boids/GridBoids\";\r\n\r\nconst makeSyncPeers = (\r\n    gameState: GameState,\r\n    droppers: {dropFromPeer: (nodes: number[]) => void},\r\n    boids: GridBoids\r\n) => () => {\r\n    const ls = gameState.lobbyState;\r\n    if (!ls) return;\r\n    if (ls.ownPeerData.nodesTouched && ls.ownPeerData.nodesTouched.length) {\r\n        ls.send && ls.send(ls.ownPeerData);\r\n        ls.ownPeerData.nodesTouched = [] as number[];\r\n    }\r\n    if (ls.otherPeerData.nodesTouched && ls.otherPeerData.nodesTouched.length) {\r\n        droppers.dropFromPeer(ls.otherPeerData.nodesTouched);\r\n        ls.otherPeerData.nodesTouched = [] as number[];\r\n    }\r\n    // if (ls.ownPeerData.isOP) {\r\n    //     ls.ownPeerData.boids = boids.boids.map(boid => ({\r\n    //         node: boid.node,\r\n    //         position: {x: boid.position.x, y: boid.position.y},\r\n    //         velocity: boid.velocity,\r\n    //         drag: boid.drag,\r\n    //         speed: boid.speed,\r\n    //         thrust: boid.thrust,\r\n    //         radius: boid.radius\r\n    //     }));\r\n    // } else {\r\n    // // sync boids\r\n    // if (ls.otherPeerData.boids) {\r\n    //     while (ls.otherPeerData.boids.length > boids.boids.length) {\r\n    //         const b = boids.addBoid(ls.otherPeerData[boids.boids.length - 1]);\r\n    //     }\r\n    //     ls.otherPeerData.boids.forEach((b, i) => {\r\n    //         if (boids.boids.length <= i) {\r\n    //             boids.boids.pop();\r\n    //             return;\r\n    //         }\r\n    //         const ownBoid = boids.boids[i];\r\n    //         ownBoid.position.x = b.position.x;\r\n    //         ownBoid.position.y = b.position.y;\r\n    //         ownBoid.velocity = b.velocity;\r\n    //         ownBoid.drag = b.drag;\r\n    //         ownBoid.speed = b.speed;\r\n    //         ownBoid.thrust = b.thrust;\r\n    //         ownBoid.radius = b.radius;\r\n    //     });\r\n    // }\r\n    // }\r\n};\r\nexport function initialize(gameCanvas: HTMLDivElement, gameState: GameState) {\r\n    const onTopScored = () => {\r\n        gameState.score.top += 1;\r\n    };\r\n    const onBottomScored = () => {\r\n        gameState.score.bottom += 1;\r\n    };\r\n    const map = makeMap(gameCanvas);\r\n    const scent = makeAvoidScent(map);\r\n    const boids = makeBoids(map, scent.data);\r\n    const collectors = makeCollectors({\r\n        display: map.display,\r\n        grid: map.grid,\r\n        boids,\r\n        colors: gameState.colors,\r\n        actions: {onTopScored, onBottomScored}\r\n    });\r\n    const fillbars = makeFillbars(gameState.fillbars);\r\n    const droppers = makeScentDroppers(gameState, map, scent.data, fillbars);\r\n    const syncPeers = makeSyncPeers(gameState, droppers, boids);\r\n    const update = (delta: number) => {\r\n        collectors.update(delta);\r\n        droppers.update(delta);\r\n        scent.update(delta);\r\n        boids.update(delta);\r\n        fillbars.update(delta);\r\n        gameState.duration += delta;\r\n        syncPeers();\r\n    };\r\n    timeVariableLoop(gameState.time, update);\r\n    const reset = () => {\r\n        scent.data.scentGrid.forEach((v, i) => (scent.data.scentGrid[i] = 0));\r\n        droppers.droppers.updates = [];\r\n        boids.reset();\r\n        gameState.score.top = 0;\r\n        gameState.score.bottom = 0;\r\n        fillbars.bars.top = fillbars.bars.max;\r\n        fillbars.bars.bottom = fillbars.bars.max;\r\n        populateBoids(boids);\r\n    };\r\n    gameState.actions.reset = reset;\r\n}\r\n","import Grid from \"scentmap/hexgrid/Grid\";\r\nimport {IDisplay} from \"../pixi/types\";\r\nimport {makeBoidsViews} from \"pixi/boids/makeBoidsViews\";\r\nimport {GridBoids} from \"boids/GridBoids\";\r\nimport {collectorTouchedTween} from \"./collectorTouchedTween\";\r\n\r\nexport function makeCollectors(p: {\r\n    display: IDisplay;\r\n    grid: Grid;\r\n    boids: GridBoids;\r\n    colors: {top: number; bottom: number};\r\n    actions: {onTopScored: () => void; onBottomScored: () => void};\r\n}) {\r\n    const {display, grid, boids, colors, actions: callbacks} = p;\r\n    const top = Array.from({length: 22}, (n, i) => 53 + i);\r\n    const bottom = Array.from({length: 22}, (n, i) => 1226 + i);\r\n    const all = [...top, ...bottom];\r\n\r\n    const views = makeBoidsViews(display.hexTexture, top.length + bottom.length);\r\n    display.camera.addChild(views.view);\r\n\r\n    const effectViews = makeBoidsViews(display.hexTexture, top.length + bottom.length);\r\n    display.camera.addChild(effectViews.view);\r\n    const effectSprites = effectViews.sprites;\r\n\r\n    views.sprites.forEach((sprite, i) => {\r\n        sprite.tint = i < top.length ? colors.top : colors.bottom;\r\n        const p = grid.getPosAtNode(all[i]);\r\n        sprite.position.set(p.x, p.y);\r\n        sprite.scale.set(1, 1);\r\n\r\n        const effectSprite = effectSprites[i];\r\n        effectSprite.tint = i < top.length ? colors.top : colors.bottom;\r\n        effectSprite.position.set(p.x + effectSprite.width / 2, p.y + effectSprite.height / 2);\r\n        effectSprite.scale.set(1, 1);\r\n        effectSprite.anchor.set(0.5, 0.5);\r\n    });\r\n\r\n    const update = (delta: number) => {\r\n        boids.boids.forEach(boid => {\r\n            const ind = all.indexOf(boid.node);\r\n            if (ind !== -1) {\r\n                boids.removeBoid(boid);\r\n                const sprite = effectSprites[ind];\r\n                collectorTouchedTween({sprite});\r\n                ind < top.length ? callbacks.onTopScored() : callbacks.onBottomScored();\r\n            }\r\n        });\r\n    };\r\n\r\n    return {top, bottom, all, views, update};\r\n}\r\n","import React, {useRef, useEffect} from \"react\";\nimport {GameState, GAME_STATE} from \"components/types\";\nimport {observable, autorun, action} from \"mobx\";\nimport {Hud} from \"components/Hud\";\nimport {TimeCountdown} from \"components/duel/TimeCountdown\";\nimport {initialize} from \"./game/init/initialize\";\nimport {getLobbyState} from \"components/lobby/getLobbyState\";\n\n/*\n  TODO\n    * fillbar\n        * spend rate\n        * refill rate\n    proper ui\n        * game screen (hud)\n        * before game screen\n        * screens management\n        * practice screen\n            * hud\n               *  with back button\n                * without opponent stuff\n        * duel screen\n        * game over detection\n        * game over screens\n            * practice\n            * duel\n    * game time counter\n    * moar colors\n    peer connection\n        * matchmaking screen\n        * find/await peer, make connection\n        *  get mutual agreement to play\n            * each has to click \"READY\"\n        pass data\n            use PeerData\n                get tap positions\n                update and dispatch every tick\n        connection fail states\n            disconnection\n        better endgame screen for duel\n    solve bug where boids get stuck in walls\n    solve bug where switching tab and returning messes boids positions up\n*/\n\nfunction App() {\n    const canvasRef = useRef(null as HTMLDivElement | null);\n    const gameState = observable({\n        gameState: GAME_STATE.intro,\n        score: {top: 0, bottom: 0},\n        fillbars: {max: 100, top: 100, bottom: 100},\n        colors: {top: 0x80ff80, bottom: 0xff8080},\n        duration: 0,\n        maxDuration: 30,\n        actions: {},\n        time: {speed: 1},\n        isGameOver: true\n    }) as GameState;\n    getLobbyState(gameState);\n    const endGame = action(() => {\n        gameState.time.speed = 0;\n        gameState.isGameOver = true;\n    });\n    const startGame = action(() => {\n        gameState.isGameOver = false;\n        gameState.actions.reset && gameState.actions.reset();\n        gameState.time.speed = 1;\n        gameState.duration = gameState.gameState === GAME_STATE.duel ? 0 : gameState.maxDuration;\n    });\n\n    gameState.actions.endGame = endGame;\n    gameState.actions.startGame = startGame;\n\n    useEffect(() => {\n        canvasRef.current && initialize(canvasRef.current, gameState);\n    }, [canvasRef]);\n\n    useEffect(() => {\n        return autorun(() => {\n            gameState.score.bottom + gameState.score.top >= 33 && endGame();\n        });\n    }, []);\n\n    useEffect(() => {\n        return autorun(\n            () =>\n                (gameState.gameState === GAME_STATE.practice || gameState.gameState === GAME_STATE.duel) && startGame()\n        );\n    }, []);\n    return (\n        <div style={{position: \"relative\", backgroundColor: \"black\", width: \"100vw\", height: \"100vh\"}}>\n            <TimeCountdown {...{data: gameState}} />\n            <div style={{position: \"fixed\"}} ref={canvasRef} />\n            <Hud {...{gameState}} />\n        </div>\n    );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}